<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZL TA-Learning Online Teaching Assistant</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Mitr:wght@300;400;500;600;700&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <script src="https://meet.jit.si/external_api.js"></script>
    <style>
        /* CSS styles ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏° */
        :root {
            --primary-color: #E6F7FF;
            --secondary-color: #FFF9C4;
            --main-title: #1A237E;
            --sub-title: #FFD700;
            --success-color: #2E7D32;
            --warning-color: #F57C00;
            --danger-color: #C62828;
            --info-color: #0277BD;
            --light-color: #F8F9FA;
            --dark-color: #212529;
            --border-radius: 12px;
            --box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Mitr', sans-serif;
        }

        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* Header & Navigation */
        header {
            background: linear-gradient(135deg, var(--primary-color), #B3E5FC);
            padding: 15px 30px;
            border-bottom: 3px solid #90CAF9;
            position: sticky;
            top: 0;
            z-index: 1000;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 15px rgba(0,0,0,0.1);
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-img {
            height: 50px;
            width: auto;
            object-fit: contain;
        }

        .logo-text h1 {
            color: var(--main-title);
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 3px;
        }

        .logo-text p {
            color: var(--main-title);
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .header-controls {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .user-info {
            background-color: white;
            padding: 8px 15px;
            border-radius: 8px;
            border: 2px solid #BBDEFB;
            font-weight: 600;
            color: var(--main-title);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .logout-btn {
            background-color: var(--danger-color);
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
        }

        .logout-btn:hover {
            background-color: #B71C1C;
            transform: translateY(-2px);
        }

        /* Main Container */
        .main-container {
            display: flex;
            min-height: calc(100vh - 90px);
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            background-color: white;
            border-right: 3px solid #B3E5FC;
            padding: 20px;
            overflow-y: auto;
            transition: var(--transition);
            position: relative;
        }

        .sidebar.collapsed {
            width: 60px;
            padding: 20px 10px;
        }

        .toggle-sidebar {
            position: absolute;
            top: 15px;
            right: -15px;
            background-color: var(--main-title);
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            z-index: 100;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }

        .user-profile {
            text-align: center;
            padding: 20px 0;
            border-bottom: 2px solid #E6F7FF;
            margin-bottom: 20px;
        }

        .user-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--main-title), #3949AB);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            margin: 0 auto 15px;
            border: 3px solid var(--sub-title);
        }

        .user-profile h3 {
            color: var(--main-title);
            margin-bottom: 5px;
            font-size: 1.3rem;
        }

        .user-profile p {
            color: #666;
            font-size: 0.9rem;
        }

        .sidebar-menu {
            list-style: none;
        }

        .sidebar-menu li {
            margin-bottom: 8px;
        }

        .menu-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 15px;
            border-radius: var(--border-radius);
            color: var(--main-title);
            text-decoration: none;
            transition: var(--transition);
            font-weight: 500;
            border: 2px solid transparent;
        }

        .menu-item:hover, .menu-item.active {
            background-color: var(--primary-color);
            border-color: #81D4FA;
            color: var(--main-title);
        }

        .menu-item i {
            font-size: 1.2rem;
            width: 24px;
            text-align: center;
        }

        .menu-text {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .sidebar.collapsed .menu-text {
            display: none;
        }

        /* Content Area */
        .content {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
        }

        .page-title {
            color: var(--main-title);
            font-size: 2.2rem;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 3px solid var(--sub-title);
        }

        /* Cards */
        .card {
            background: white;
            padding: 25px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            margin-bottom: 25px;
            border: 3px solid #E3F2FD;
            transition: var(--transition);
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            border-color: var(--sub-title);
        }

        .card-title {
            color: var(--main-title);
            font-size: 1.5rem;
            margin-bottom: 20px;
            border-bottom: 2px solid var(--secondary-color);
            padding-bottom: 10px;
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, var(--main-title), #3949AB);
            color: white;
            padding: 25px;
            border-radius: var(--border-radius);
            text-align: center;
            border: 3px solid var(--sub-title);
        }

        .stat-card h3 {
            font-size: 2.5rem;
            margin: 10px 0;
        }

        .stat-card p {
            opacity: 0.9;
            font-size: 0.95rem;
        }

        /* Forms */
        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--main-title);
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #BBDEFB;
            border-radius: 8px;
            font-size: 1rem;
            transition: var(--transition);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--main-title);
            box-shadow: 0 0 0 3px rgba(26, 35, 126, 0.1);
        }

        .form-check {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .form-check-input {
            width: 18px;
            height: 18px;
        }

        /* Buttons */
        .btn {
            display: inline-block;
            padding: 12px 28px;
            border-radius: 8px;
            font-weight: 600;
            transition: var(--transition);
            font-size: 1rem;
            cursor: pointer;
            border: none;
            text-align: center;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--main-title), #3949AB);
            color: white;
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #3949AB, #283593);
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(26, 35, 126, 0.3);
        }

        .btn-secondary {
            background-color: #6C757D;
            color: white;
        }

        .btn-secondary:hover {
            background-color: #5A6268;
            transform: translateY(-3px);
        }

        .btn-success {
            background-color: var(--success-color);
            color: white;
        }

        .btn-success:hover {
            background-color: #1B5E20;
            transform: translateY(-3px);
        }

        .btn-warning {
            background-color: var(--warning-color);
            color: white;
        }

        .btn-warning:hover {
            background-color: #E65100;
            transform: translateY(-3px);
        }

        .btn-danger {
            background-color: var(--danger-color);
            color: white;
        }

        .btn-danger:hover {
            background-color: #B71C1C;
            transform: translateY(-3px);
        }

        .btn-lg {
            padding: 15px 35px;
            font-size: 1.1rem;
        }

        .btn-block {
            display: block;
            width: 100%;
        }

        /* Alerts */
        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 2px solid transparent;
        }

        .alert-success {
            background-color: #E8F5E9;
            border-color: #A5D6A7;
            color: var(--success-color);
        }

        .alert-warning {
            background-color: #FFF3CD;
            border-color: #FFC107;
            color: var(--warning-color);
        }

        .alert-danger {
            background-color: #FFEBEE;
            border-color: #EF9A9A;
            color: var(--danger-color);
        }

        .alert-info {
            background-color: #E3F2FD;
            border-color: #64B5F6;
            color: var(--info-color);
        }

        /* Live Class Layout */
        .live-container {
            display: flex;
            gap: 25px;
            height: calc(100vh - 180px);
        }

        .video-section {
            flex: 3;
            background-color: #000;
            border-radius: var(--border-radius);
            overflow: hidden;
            position: relative;
            border: 3px solid var(--sub-title);
        }

        .lesson-section {
            flex: 1;
            background-color: white;
            border-radius: var(--border-radius);
            padding: 20px;
            overflow-y: auto;
            border: 3px solid #E3F2FD;
        }

        /* Video Controls */
        .video-container {
            width: 100%;
            height: 100%;
            position: relative;
        }

        #jitsi-container, #jitsi-container-floating {
            width: 100%;
            height: 100%;
            background: #000;
        }

        .jitsi-video-active {
            background: transparent !important;
        }

        .video-placeholder {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            background-color: #333;
        }

        .video-placeholder i {
            font-size: 4rem;
            margin-bottom: 20px;
            color: #666;
        }

        .video-controls {
            position: absolute;
            bottom: 20px;
            left: 0;
            right: 0;
            display: flex;
            justify-content: center;
            gap: 15px;
            padding: 0 20px;
            z-index: 100;
        }

        .video-control-btn {
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.2rem;
            transition: var(--transition);
        }

        .video-control-btn:hover {
            background-color: rgba(0, 0, 0, 0.9);
            transform: scale(1.1);
        }

        /* Floating Video (for exercise mode) */
        .floating-video {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 320px;
            height: 240px;
            background-color: #000;
            border-radius: 12px;
            border: 3px solid var(--sub-title);
            z-index: 999;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
            overflow: hidden;
            resize: both;
            overflow: auto;
            cursor: move;
        }

        .floating-video.minimized {
            width: 80px;
            height: 80px;
            bottom: 20px;
            right: 20px;
        }

        .floating-video-header {
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 8px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: move;
        }

        .floating-controls {
            display: flex;
            gap: 10px;
        }

        .floating-control-btn {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 1rem;
        }

        .floating-video-content {
            width: 100%;
            height: calc(100% - 40px);
            background-color: #000;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Exercise Layout */
        .exercise-container {
            margin-right: 340px;
            padding: 20px;
        }

        .exercise-item {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            border-left: 5px solid var(--success-color);
            transition: var(--transition);
        }

        .exercise-item:hover {
            background: #F1F8E9;
        }

        .exercise-question {
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--main-title);
            font-size: 1.1rem;
        }

        .exercise-image {
            width: 100%;
            max-width: 500px;
            border-radius: 8px;
            margin: 15px 0;
            border: 3px solid #B3E5FC;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        .exercise-answer {
            background: #E8F5E9;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            border: 2px solid #C8E6C9;
        }

        /* Course Grid */
        .course-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 25px;
            margin: 25px 0;
        }

        .course-card {
            background: white;
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            margin: 15px 0;
            border: 2px solid #E3F2FD;
            transition: var(--transition);
        }

        .course-card:hover {
            border-color: var(--sub-title);
            transform: scale(1.02);
        }

        .course-card h4 {
            color: var(--main-title);
            margin-bottom: 10px;
            font-size: 1.3rem;
            border-bottom: 2px solid var(--secondary-color);
            padding-bottom: 8px;
        }

        .course-image {
            width: 100%;
            height: 180px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 2px solid #B3E5FC;
        }

        /* Tabs */
        .tabs {
            display: flex;
            border-bottom: 2px solid #E3F2FD;
            margin-bottom: 25px;
        }

        .tab {
            padding: 15px 30px;
            background: none;
            border: none;
            font-size: 1rem;
            font-weight: 600;
            color: #666;
            cursor: pointer;
            transition: var(--transition);
            border-bottom: 3px solid transparent;
        }

        .tab:hover {
            color: var(--main-title);
        }

        .tab.active {
            color: var(--main-title);
            border-bottom: 3px solid var(--main-title);
            background-color: rgba(230, 247, 255, 0.5);
        }

        .tab-content {
            display: none;
            padding: 20px 0;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        /* Tables */
        .table-container {
            overflow-x: auto;
            margin-bottom: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background-color: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }

        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #E3F2FD;
        }

        th {
            background-color: var(--primary-color);
            color: var(--main-title);
            font-weight: 600;
        }

        tr:hover {
            background-color: #F8F9FA;
        }

        /* Upload Area */
        .upload-area {
            border: 2px dashed #6C757D;
            border-radius: 10px;
            padding: 40px 20px;
            text-align: center;
            margin: 20px 0;
            background-color: #F8F9FA;
            transition: var(--transition);
            cursor: pointer;
        }

        .upload-area:hover {
            border-color: var(--main-title);
            background-color: #E9ECEF;
        }

        .upload-icon {
            font-size: 48px;
            color: #6C757D;
            margin-bottom: 15px;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background-color: white;
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            animation: modalSlideIn 0.3s ease;
        }

        .modal-header {
            padding: 20px;
            border-bottom: 2px solid #E3F2FD;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            color: var(--main-title);
        }

        .modal-body {
            padding: 20px;
        }

        .modal-footer {
            padding: 20px;
            border-top: 2px solid #E3F2FD;
            display: flex;
            justify-content: flex-end;
            gap: 15px;
        }

        /* Progress Bar */
        .progress {
            height: 12px;
            background-color: #E3F2FD;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--sub-title), #FFECB3);
            border-radius: 6px;
            transition: width 0.5s ease;
        }

        /* Badges */
        .badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .badge-success {
            background-color: #C8E6C9;
            color: var(--success-color);
            border: 1px solid #A5D6A7;
        }

        .badge-warning {
            background-color: var(--secondary-color);
            color: var(--warning-color);
            border: 1px solid #FFD54F;
        }

        .badge-danger {
            background-color: #FFCDD2;
            color: var(--danger-color);
            border: 1px solid #EF9A9A;
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes modalSlideIn {
            from { opacity: 0; transform: translateY(-50px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Loading Spinner */
        .spinner {
            border: 4px solid var(--primary-color);
            border-top: 4px solid var(--main-title);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        /* Mobile Responsiveness */
        @media (max-width: 992px) {
            .main-container {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                height: auto;
                position: static;
            }

            .sidebar.collapsed {
                width: 100%;
                height: auto;
            }

            .live-container {
                flex-direction: column;
                height: auto;
            }

            .video-section, .lesson-section {
                flex: none;
                width: 100%;
            }

            .video-section {
                height: 400px;
            }

            .exercise-container {
                margin-right: 0;
                padding: 10px;
            }

            .floating-video {
                width: 250px;
                height: 200px;
            }
        }

        @media (max-width: 768px) {
            .course-grid {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .tabs {
                flex-wrap: wrap;
            }

            .tab {
                flex: 1;
                min-width: 120px;
                text-align: center;
            }

            header {
                padding: 15px;
                flex-direction: column;
                gap: 15px;
            }

            .header-controls {
                width: 100%;
                justify-content: space-between;
            }

            .logo-text h1 {
                font-size: 1.5rem;
            }
        }

        @media (max-width: 576px) {
            .content {
                padding: 15px;
            }

            .card {
                padding: 15px;
            }

            .page-title {
                font-size: 1.8rem;
            }

            .btn {
                padding: 10px 20px;
                font-size: 0.9rem;
            }

            .floating-video {
                width: 200px;
                height: 150px;
            }
        }

        /* Utility Classes */
        .text-center {
            text-align: center;
        }

        .text-right {
            text-align: right;
        }

        .text-left {
            text-align: left;
        }

        .mb-0 {
            margin-bottom: 0;
        }

        .mb-10 {
            margin-bottom: 10px;
        }

        .mb-20 {
            margin-bottom: 20px;
        }

        .mb-30 {
            margin-bottom: 30px;
        }

        .mt-10 {
            margin-top: 10px;
        }

        .mt-20 {
            margin-top: 20px;
        }

        .mt-30 {
            margin-top: 30px;
        }

        .d-flex {
            display: flex;
        }

        .align-center {
            align-items: center;
        }

        .justify-between {
            justify-content: space-between;
        }

        .justify-center {
            justify-content: center;
        }

        .flex-column {
            flex-direction: column;
        }

        .gap-10 {
            gap: 10px;
        }

        .gap-15 {
            gap: 15px;
        }

        .gap-20 {
            gap: 20px;
        }

        .w-100 {
            width: 100%;
        }

        .hidden {
            display: none;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--primary-color);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--main-title);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #3949AB;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #666;
        }

        .empty-state i {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.5;
            color: #999;
        }

        /* Jitsi Connection Status */
        .jitsi-status {
            background: var(--primary-color);
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
            text-align: center;
            border: 2px solid #81D4FA;
        }

        .jitsi-status.connected {
            background: #E8F5E9;
            border-color: #A5D6A7;
        }

        .jitsi-status.disconnected {
            background: #FFEBEE;
            border-color: #EF9A9A;
        }

        /* Course Image Preview */
        .course-image-preview {
            width: 100%;
            max-height: 200px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 2px solid #BBDEFB;
            display: none;
        }

        .course-image-preview.show {
            display: block;
        }

        /* CSV Import Controls */
        .csv-controls {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }

        /* AI Generated Exercise */
        .ai-exercise-generator {
            background: #F8F9FA;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            border: 2px dashed #81D4FA;
        }

        .ai-prompt-box {
            width: 100%;
            min-height: 80px;
            padding: 12px;
            border: 2px solid #BBDEFB;
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 1rem;
            resize: vertical;
        }

        .ai-exercise-preview {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            border: 2px solid #E3F2FD;
            display: none;
        }

        .ai-exercise-preview.show {
            display: block;
        }

        /* File Upload Preview */
        .file-preview {
            margin-top: 15px;
            padding: 15px;
            background: #F8F9FA;
            border-radius: 8px;
            border: 2px solid #E3F2FD;
        }

        .file-preview img {
            max-width: 100%;
            max-height: 200px;
            border-radius: 8px;
        }

        .file-info {
            margin-top: 10px;
            font-size: 0.9rem;
            color: #666;
        }

        /* Form Actions */
        .form-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            justify-content: flex-end;
        }

        /* Draggable Video */
        .floating-video.dragging {
            opacity: 0.8;
            box-shadow: 0 12px 40px rgba(0,0,0,0.4);
        }
        
        /* Language Selection */
        .language-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .lang-btn {
            padding: 8px 16px;
            border: 2px solid #BBDEFB;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .lang-btn.active {
            background: var(--primary-color);
            border-color: var(--main-title);
            color: var(--main-title);
            font-weight: 600;
        }
        
        /* Chinese Font */
        .chinese-font {
            font-family: 'Noto Sans TC', 'Microsoft JhengHei', sans-serif;
        }
        
        /* File Upload Info */
        .file-upload-info {
            background: #E3F2FD;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            border: 2px solid #BBDEFB;
        }
        
        .file-name {
            font-weight: 600;
            color: var(--main-title);
        }
        
        /* AI Prompt Examples */
        .ai-examples {
            background: #F0F8FF;
            border-radius: 8px;
            padding: 15px;
            margin-top: 10px;
            border-left: 4px solid #4A90E2;
        }
        
        .ai-examples h5 {
            color: #4A90E2;
            margin-bottom: 10px;
        }
        
        .example-item {
            background: white;
            border-radius: 6px;
            padding: 10px;
            margin-bottom: 8px;
            cursor: pointer;
            border: 1px solid #E3F2FD;
            transition: var(--transition);
        }
        
        .example-item:hover {
            background: #E3F2FD;
            transform: translateX(5px);
        }
        
        /* Video Placeholder Fix */
        #jitsi-container > iframe,
        #jitsi-container-floating > iframe {
            width: 100% !important;
            height: 100% !important;
        }
        
        /* Teacher Management */
        .teacher-actions {
            display: flex;
            gap: 5px;
        }
        
        .btn-sm {
            padding: 6px 12px;
            font-size: 0.875rem;
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Header -->
    <header>
        <div class="logo-container">
            <img id="logo-img" class="logo-img" src="" alt="ZL TA-Learning Logo">
            <div class="logo-text">
                <h1>ZL TA-Learning</h1>
                <p>‡∏£‡∏∞‡∏ö‡∏ö‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢‡∏™‡∏≠‡∏ô-‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå (100% Live Class)</p>
            </div>
        </div>
        <div class="header-controls">
            <div id="user-info" class="user-info hidden">
                <i class="fas fa-user"></i>
                <span id="user-name"></span>
            </div>
            <button id="logout-btn" class="logout-btn hidden">
                <i class="fas fa-sign-out-alt"></i> ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
            </button>
        </div>
    </header>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Sidebar -->
        <aside id="sidebar" class="sidebar">
            <button id="toggle-sidebar" class="toggle-sidebar">
                <i id="toggle-icon" class="fas fa-chevron-left"></i>
            </button>
            <div id="user-profile" class="user-profile hidden">
                <div class="user-avatar">
                    <i class="fas fa-user"></i>
                </div>
                <h3 id="sidebar-user-name"></h3>
                <p id="sidebar-user-role"></p>
            </div>
            <ul id="sidebar-menu" class="sidebar-menu"></ul>
        </aside>

        <!-- Content -->
        <main class="content">
            <!-- Pages will be dynamically loaded here -->
            <div id="page-content"></div>
        </main>
    </div>

    <!-- Floating Video Container (for exercise mode) -->
    <div id="floating-video" class="floating-video hidden">
        <div class="floating-video-header" id="floating-video-header">
            <span>üé• ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡∏î</span>
            <div class="floating-controls">
                <button id="minimize-video" class="floating-control-btn">
                    <i class="fas fa-window-minimize"></i>
                </button>
                <button id="close-video" class="floating-control-btn">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
        <div class="floating-video-content">
            <div id="jitsi-container-floating"></div>
            <div id="floating-video-placeholder" class="video-placeholder">
                <i class="fas fa-video"></i>
                <p>‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡∏î</p>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div id="login-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö ZL TA-Learning</h3>
                <button id="close-login-modal" class="floating-control-btn">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="tabs mb-20">
                    <button class="tab active" data-tab="student-login">‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</button>
                    <button class="tab" data-tab="teacher-login">‡∏Ñ‡∏£‡∏π‡∏ú‡∏π‡πâ‡∏™‡∏≠‡∏ô</button>
                    <button class="tab" data-tab="teacher-register">‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏Ñ‡∏£‡∏π</button>
                </div>
                
                <div id="student-login" class="tab-content active">
                    <form id="student-login-form">
                        <div class="form-group">
                            <label for="student-name">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• *</label>
                            <input type="text" id="student-name" class="form-control" placeholder="‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•" required>
                        </div>
                        <div class="form-group">
                            <label for="student-email">‡∏≠‡∏µ‡πÄ‡∏°‡∏• (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)</label>
                            <input type="email" id="student-email" class="form-control" placeholder="example@email.com">
                        </div>
                        <div class="form-check">
                            <input type="checkbox" id="student-terms" class="form-check-input" required>
                            <label for="student-terms">‡∏¢‡∏≠‡∏°‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏ï‡∏Å‡∏•‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</label>
                        </div>
                        <button type="submit" class="btn btn-primary btn-block mt-20">
                            <i class="fas fa-sign-in-alt"></i> ‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
                        </button>
                    </form>
                </div>
                
                <div id="teacher-login" class="tab-content">
                    <form id="teacher-login-form">
                        <div class="form-group">
                            <label for="teacher-username">Username *</label>
                            <input type="text" id="teacher-username" class="form-control" placeholder="‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å Username" required>
                        </div>
                        <div class="form-group">
                            <label for="teacher-password">Password *</label>
                            <input type="password" id="teacher-password" class="form-control" placeholder="‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å Password" required>
                        </div>
                        <button type="submit" class="btn btn-primary btn-block">
                            <i class="fas fa-sign-in-alt"></i> ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
                        </button>
                    </form>
                </div>
                
                <div id="teacher-register" class="tab-content">
                    <form id="teacher-register-form">
                        <div class="form-group">
                            <label for="teacher-fullname">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• *</label>
                            <input type="text" id="teacher-fullname" class="form-control" placeholder="‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•" required>
                        </div>
                        <div class="form-group">
                            <label for="teacher-email">‡∏≠‡∏µ‡πÄ‡∏°‡∏• *</label>
                            <input type="email" id="teacher-email" class="form-control" placeholder="example@email.com" required>
                        </div>
                        <div class="form-group">
                            <label for="teacher-phone">‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå *</label>
                            <input type="tel" id="teacher-phone" class="form-control" placeholder="0812345678" required>
                        </div>
                        <div class="form-group">
                            <label for="teacher-username-reg">Username *</label>
                            <input type="text" id="teacher-username-reg" class="form-control" placeholder="‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å Username" required>
                        </div>
                        <div class="form-group">
                            <label for="teacher-password-reg">Password *</label>
                            <input type="password" id="teacher-password-reg" class="form-control" placeholder="‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å Password" required>
                        </div>
                        <div class="form-check">
                            <input type="checkbox" id="teacher-terms" class="form-check-input" required>
                            <label for="teacher-terms">‡∏¢‡∏≠‡∏°‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏ï‡∏Å‡∏•‡∏á</label>
                        </div>
                        <button type="submit" class="btn btn-success btn-block mt-20">
                            <i class="fas fa-user-plus"></i> ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏Ñ‡∏£‡∏π‡∏ú‡∏π‡πâ‡∏™‡∏≠‡∏ô
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div id="course-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≠‡∏£‡πå‡∏™‡πÉ‡∏´‡∏°‡πà</h3>
                <button id="close-course-modal" class="floating-control-btn">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="course-form">
                    <div class="form-group">
                        <label for="course-name">‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏≠‡∏£‡πå‡∏™ *</label>
                        <input type="text" id="course-name" class="form-control" placeholder="‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏≠‡∏£‡πå‡∏™" required>
                    </div>
                    <div class="form-group">
                        <label for="course-type">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô *</label>
                        <select id="course-type" class="form-control" required>
                            <option value="1:1">‡∏ï‡∏±‡∏ß‡∏ï‡πà‡∏≠‡∏ï‡∏±‡∏ß (1:1)</option>
                            <option value="2-5">‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÄ‡∏•‡πá‡∏Å (2-5 ‡∏Ñ‡∏ô)</option>
                            <option value="group">‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÉ‡∏´‡∏ç‡πà</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="course-description">‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏Ñ‡∏≠‡∏£‡πå‡∏™ *</label>
                        <textarea id="course-description" class="form-control" rows="3" placeholder="‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ñ‡∏≠‡∏£‡πå‡∏™" required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="course-image">‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏Ñ‡∏≠‡∏£‡πå‡∏™</label>
                        <input type="file" id="course-image" class="form-control" accept="image/*">
                        <img id="course-image-preview" class="course-image-preview" src="" alt="Course Image Preview">
                        <small class="text-muted">‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå JPG, PNG, GIF (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)</small>
                    </div>
                    <div class="form-group">
                        <label for="max-students">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î</label>
                        <input type="number" id="max-students" class="form-control" value="10" min="1" max="50">
                    </div>
                    <div class="form-group">
                        <label for="jitsi-room">‡∏ä‡∏∑‡πà‡∏≠‡∏´‡πâ‡∏≠‡∏á Jitsi *</label>
                        <input type="text" id="jitsi-room" class="form-control" placeholder="my-classroom-001" required>
                        <small class="text-muted">‡∏ä‡∏∑‡πà‡∏≠‡∏´‡πâ‡∏≠‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Jitsi Meet</small>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button id="cancel-course" class="btn btn-secondary">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                <button id="save-course" class="btn btn-primary">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏≠‡∏£‡πå‡∏™</button>
            </div>
        </div>
    </div>

    <div id="lesson-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="lesson-modal-title">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h3>
                <button id="close-lesson-modal" class="floating-control-btn">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="lesson-form">
                    <div class="form-group">
                        <label for="lesson-title">‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô *</label>
                        <input type="text" id="lesson-title" class="form-control" placeholder="‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô" required>
                    </div>
                    <div class="form-group">
                        <label for="lesson-content">‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô *</label>
                        <textarea id="lesson-content" class="form-control" rows="6" placeholder="‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô" required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="lesson-file">‡πÑ‡∏ü‡∏•‡πå‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö</label>
                        <div class="upload-area" id="lesson-file-area">
                            <div class="upload-icon">
                                <i class="fas fa-file-upload"></i>
                            </div>
                            <h4>‡∏•‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏°‡∏≤‡∏ß‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà</h4>
                            <p class="mb-20">‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå</p>
                            <input type="file" id="lesson-file" class="hidden" accept=".pdf,.doc,.docx,.ppt,.pptx,.txt,.jpg,.jpeg,.png">
                            <button type="button" id="browse-lesson-file" class="btn btn-primary">
                                <i class="fas fa-folder-open"></i> ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå
                            </button>
                            <small class="text-muted mt-20 d-block">‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå PDF, Word, PowerPoint, Text, Images</small>
                        </div>
                        <div id="lesson-file-preview" class="file-preview hidden">
                            <div id="lesson-file-info" class="file-info"></div>
                        </div>
                    </div>
                    <input type="hidden" id="lesson-id">
                    <input type="hidden" id="lesson-course-id">
                </form>
            </div>
            <div class="modal-footer">
                <button id="cancel-lesson" class="btn btn-secondary">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                <button id="save-lesson" class="btn btn-primary">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</button>
            </div>
        </div>
    </div>

    <div id="exercise-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="exercise-modal-title">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î</h3>
                <button id="close-exercise-modal" class="floating-control-btn">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="ai-exercise-generator">
                    <h4>üéØ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î‡∏î‡πâ‡∏ß‡∏¢ AI</h4>
                    
                    <!-- Language Selector -->
                    <div class="language-selector mb-20">
                        <button type="button" class="lang-btn active" data-lang="english">English</button>
                        <button type="button" class="lang-btn" data-lang="chinese">‰∏≠Êñá (Chinese)</button>
                        <button type="button" class="lang-btn" data-lang="thai">‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢</button>
                    </div>
                    
                    <div class="form-group">
                        <label for="ai-prompt">‡πÇ‡∏õ‡∏£‡∏î‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î:</label>
                        <textarea id="ai-prompt" class="ai-prompt-box" placeholder="‡πÄ‡∏ä‡πà‡∏ô: ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á Present Simple Tense..."></textarea>
                    </div>
                    
                    <!-- AI Prompt Examples -->
                    <div class="ai-examples">
                        <h5>üí° ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á:</h5>
                        <div class="example-item" data-example="‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á Present Simple Tense ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏ñ‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤ 5 ‡∏Ç‡πâ‡∏≠">
                            <strong>‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©:</strong> ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á Present Simple Tense ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏ñ‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤ 5 ‡∏Ç‡πâ‡∏≠
                        </div>
                        <div class="example-item" data-example="‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î‡∏†‡∏≤‡∏©‡∏≤‡∏à‡∏µ‡∏ô‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á ‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏ö‡πÄ‡∏•‡∏Ç 1-100 ‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ‡∏™‡∏ô‡∏ó‡∏ô‡∏≤‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô 3 ‡∏Ç‡πâ‡∏≠">
                            <strong>‡∏†‡∏≤‡∏©‡∏≤‡∏à‡∏µ‡∏ô:</strong> ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î‡∏†‡∏≤‡∏©‡∏≤‡∏à‡∏µ‡∏ô‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á ‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏ö‡πÄ‡∏•‡∏Ç 1-100 ‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ‡∏™‡∏ô‡∏ó‡∏ô‡∏≤‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô 3 ‡∏Ç‡πâ‡∏≠
                        </div>
                        <div class="example-item" data-example="‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏ó‡∏™‡∏ô‡∏ó‡∏ô‡∏≤‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏Ñ‡∏£‡∏π‡πÅ‡∏•‡∏∞‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡∏Ñ‡∏≥‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á">
                            <strong>‡∏ö‡∏ó‡∏™‡∏ô‡∏ó‡∏ô‡∏≤:</strong> ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏ó‡∏™‡∏ô‡∏ó‡∏ô‡∏≤‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏Ñ‡∏£‡∏π‡πÅ‡∏•‡∏∞‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡∏Ñ‡∏≥‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á
                        </div>
                        <div class="example-item" data-example="‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©‡∏´‡∏°‡∏ß‡∏î‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£‡∏£‡∏° 10 ‡∏Ñ‡∏≥ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Ñ‡∏≥‡πÅ‡∏õ‡∏•‡πÑ‡∏ó‡∏¢">
                            <strong>‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå:</strong> ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©‡∏´‡∏°‡∏ß‡∏î‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£‡∏£‡∏° 10 ‡∏Ñ‡∏≥ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Ñ‡∏≥‡πÅ‡∏õ‡∏•‡πÑ‡∏ó‡∏¢
                        </div>
                        <div class="example-item" data-example="‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ‡∏†‡∏≤‡∏©‡∏≤‡∏à‡∏µ‡∏ô‡∏à‡∏≤‡∏Å‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÉ‡∏´‡πâ">
                            <strong>‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ:</strong> ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ‡∏†‡∏≤‡∏©‡∏≤‡∏à‡∏µ‡∏ô‡∏à‡∏≤‡∏Å‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÉ‡∏´‡πâ
                        </div>
                    </div>
                    
                    <button id="generate-exercise" class="btn btn-primary">
                        <i class="fas fa-robot"></i> ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏î‡πâ‡∏ß‡∏¢ AI
                    </button>
                    <div id="ai-exercise-preview" class="ai-exercise-preview">
                        <h5 id="ai-preview-title">‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î‡∏ó‡∏µ‡πà AI ‡∏™‡∏£‡πâ‡∏≤‡∏á:</h5>
                        <div id="ai-generated-question" class="mb-10"></div>
                        <div id="ai-generated-answer" class="mb-20"></div>
                        <button id="use-ai-exercise" class="btn btn-success">
                            <i class="fas fa-check"></i> ‡πÉ‡∏ä‡πâ‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î‡∏ô‡∏µ‡πâ
                        </button>
                    </div>
                </div>

                <form id="exercise-form">
                    <div class="form-group">
                        <label for="exercise-lesson">‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô *</label>
                        <select id="exercise-lesson" class="form-control" required>
                            <!-- Options will be populated dynamically -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="exercise-question">‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° *</label>
                        <textarea id="exercise-question" class="form-control" rows="4" placeholder="‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°" required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="exercise-image">‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Quiz ‡∏ó‡∏≤‡∏¢‡∏£‡∏π‡∏õ)</label>
                        <div class="upload-area" id="exercise-image-area">
                            <div class="upload-icon">
                                <i class="fas fa-image"></i>
                            </div>
                            <h4>‡∏•‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏†‡∏≤‡∏û‡∏°‡∏≤‡∏ß‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà</h4>
                            <p class="mb-20">‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå</p>
                            <input type="file" id="exercise-image" class="hidden" accept="image/*">
                            <button type="button" id="browse-exercise-image" class="btn btn-primary">
                                <i class="fas fa-folder-open"></i> ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏†‡∏≤‡∏û
                            </button>
                            <small class="text-muted mt-20 d-block">‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå JPG, PNG, GIF</small>
                        </div>
                        <div id="exercise-image-preview" class="file-preview hidden">
                            <img id="exercise-preview-img" src="" alt="Exercise Image Preview">
                            <div id="exercise-image-info" class="file-info"></div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="exercise-answer">‡πÄ‡∏â‡∏•‡∏¢ *</label>
                        <textarea id="exercise-answer" class="form-control" rows="4" placeholder="‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏â‡∏•‡∏¢" required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="exercise-difficulty">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏Å</label>
                        <select id="exercise-difficulty" class="form-control">
                            <option value="easy">‡∏á‡πà‡∏≤‡∏¢</option>
                            <option value="medium" selected>‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á</option>
                            <option value="hard">‡∏¢‡∏≤‡∏Å</option>
                        </select>
                    </div>
                    <input type="hidden" id="exercise-id">
                    <input type="hidden" id="exercise-course-id">
                </form>
            </div>
            <div class="modal-footer">
                <button id="cancel-exercise" class="btn btn-secondary">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                <button id="save-exercise" class="btn btn-primary">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î</button>
            </div>
        </div>
    </div>

    <div id="upload-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏∞‡∏ö‡∏ö</h3>
                <button id="close-upload-modal" class="floating-control-btn">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="tabs mb-20">
                    <button class="tab active" data-tab="import-csv">‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• CSV</button>
                    <button class="tab" data-tab="export-csv">‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• CSV</button>
                    <button class="tab" data-tab="view-students">‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</button>
                    <button class="tab" data-tab="view-teachers">‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏π</button>
                    <button class="tab" data-tab="view-results">‡∏î‡∏π‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</button>
                </div>
                
                <div id="import-csv" class="tab-content active">
                    <div class="alert alert-info mb-20">
                        <i class="fas fa-info-circle"></i> ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå CSV ‡πÄ‡∏õ‡∏•‡πà‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏î‡πâ
                    </div>
                    <div class="upload-area" id="upload-drop-area">
                        <div class="upload-icon">
                            <i class="fas fa-file-excel"></i>
                        </div>
                        <h4>‡∏•‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå CSV ‡∏°‡∏≤‡∏ß‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà</h4>
                        <p class="mb-20">‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå</p>
                        <input type="file" id="csv-file" accept=".csv" class="hidden">
                        <button id="browse-file" class="btn btn-primary">
                            <i class="fas fa-folder-open"></i> ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå CSV
                        </button>
                        <p class="mt-20 text-muted">‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå CSV ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô (‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏õ‡∏•‡πà‡∏≤‡πÑ‡∏î‡πâ)</p>
                    </div>
                    
                    <!-- File Upload Info Section -->
                    <div id="file-upload-info" class="file-upload-info hidden">
                        <h4>üìÅ ‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î:</h4>
                        <p><span class="file-name" id="uploaded-file-name"></span></p>
                        <p id="file-status-text">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÑ‡∏ü‡∏•‡πå...</p>
                        <div id="file-details"></div>
                    </div>
                    
                    <div id="upload-preview" class="hidden mt-30">
                        <h4>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏ß‡∏à‡∏û‡∏ö:</h4>
                        <div class="table-container">
                            <table id="preview-table">
                                <thead>
                                    <tr>
                                        <th>‡∏£‡∏´‡∏±‡∏™</th>
                                        <th>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th>
                                        <th>‡∏≠‡∏µ‡πÄ‡∏°‡∏•</th>
                                        <th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th>
                                        <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                        <div class="alert alert-info mt-20">
                            <i class="fas fa-info-circle"></i> ‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• <span id="record-count">0</span> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
                        </div>
                    </div>
                </div>
                
                <div id="export-csv" class="tab-content">
                    <div class="card">
                        <h4>‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏∞‡∏ö‡∏ö</h4>
                        <p>‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö CSV</p>
                        <div class="csv-controls">
                            <button id="export-students" class="btn btn-success">
                                <i class="fas fa-download"></i> ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
                            </button>
                            <button id="export-teachers" class="btn btn-primary">
                                <i class="fas fa-download"></i> ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏π
                            </button>
                            <button id="export-results" class="btn btn-warning">
                                <i class="fas fa-download"></i> ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
                            </button>
                            <button id="download-template" class="btn btn-info">
                                <i class="fas fa-file-download"></i> ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î Template ‡πÄ‡∏õ‡∏•‡πà‡∏≤
                            </button>
                        </div>
                    </div>
                </div>
                
                <div id="view-students" class="tab-content">
                    <div class="d-flex justify-between align-center mb-20">
                        <h4>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h4>
                        <button id="refresh-students" class="btn btn-primary btn-sm">
                            <i class="fas fa-sync-alt"></i> ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä
                        </button>
                    </div>
                    <div id="students-list-container">
                        <!-- Students list will be populated here -->
                    </div>
                </div>
                
                <div id="view-teachers" class="tab-content">
                    <div class="d-flex justify-between align-center mb-20">
                        <h4>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏π‡∏ú‡∏π‡πâ‡∏™‡∏≠‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h4>
                        <button id="refresh-teachers" class="btn btn-primary btn-sm">
                            <i class="fas fa-sync-alt"></i> ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä
                        </button>
                    </div>
                    <div id="teachers-list-container">
                        <!-- Teachers list will be populated here -->
                    </div>
                </div>
                
                <div id="view-results" class="tab-content">
                    <div class="d-flex justify-between align-center mb-20">
                        <h4>‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h4>
                        <button id="refresh-results" class="btn btn-primary btn-sm">
                            <i class="fas fa-sync-alt"></i> ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä
                        </button>
                    </div>
                    <div id="results-list-container">
                        <!-- Results list will be populated here -->
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="cancel-upload" class="btn btn-secondary">‡∏õ‡∏¥‡∏î</button>
                <button id="confirm-upload" class="btn btn-primary hidden">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
            </div>
        </div>
    </div>

    <div id="preview-image-modal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h3>‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î</h3>
                <button id="close-preview-modal" class="floating-control-btn">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <img id="preview-image" src="" alt="Preview Image" style="width: 100%; border-radius: 8px;">
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // APPLICATION STATE MANAGEMENT
        // ============================================
        const AppState = {
            // User information
            user: {
                id: null,
                name: '',
                role: null, // 'student' or 'teacher'
                email: '',
                phone: '',
                hasAttendedLive: false
            },
            
            // Current page
            currentPage: 'home',
            
            // Course data
            courses: [],
            currentCourse: null,
            
            // Lesson data
            lessons: [],
            currentLesson: null,
            
            // Exercise data
            exercises: [],
            currentExercise: null,
            
            // Quiz state
            quizState: {
                currentIndex: 0,
                attempts: {},
                completed: {},
                answers: {},
                showSolution: {},
                scores: {} // Store scores for CSV export
            },
            
            // Jitsi state
            jitsi: {
                connected: false,
                roomName: null,
                displayName: null,
                floating: false,
                minimized: false,
                api: null,
            },
            
            // Data storage
            students: [],
            teachers: [],
            results: [], // Store student results
            
            // Mobile detection
            isMobile: window.innerWidth <= 768,
            
            // Floating video drag state
            floatingVideoDrag: {
                isDragging: false,
                offsetX: 0,
                offsetY: 0
            },
            
            // Current language for AI exercise generation
            currentLanguage: 'english',
            
            // Uploaded CSV file info
            uploadedFileInfo: null,
            
            // Initialize
            init() {
                // Load data from localStorage
                this.loadFromStorage();
                
                // Set up event listeners
                this.setupEventListeners();
                
                // Check if CSV data is required
                this.checkCSVRequirement();
                
                // Load logo
                this.loadLogo();
                
                // Update mobile detection on resize
                window.addEventListener('resize', () => {
                    this.isMobile = window.innerWidth <= 768;
                });
            },
            
            // Check if CSV data is required
            checkCSVRequirement() {
                const hasData = localStorage.getItem('zl_has_initial_data') === 'true';
                
                // Always show upload modal first (for empty CSV upload)
                if (!hasData) {
                    setTimeout(() => {
                        this.showAlert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå CSV ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö (‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏õ‡∏•‡πà‡∏≤‡πÑ‡∏î‡πâ)', 'warning');
                        this.showUploadModal();
                    }, 500);
                    return;
                }
                
                // Check if user is logged in
                if (this.user.role) {
                    this.showDashboard();
                } else {
                    this.showLoginModal();
                }
            },
            
            // Load data from localStorage
            loadFromStorage() {
                const savedUser = localStorage.getItem('zl_user');
                const savedCourses = localStorage.getItem('zl_courses');
                const savedTeachers = localStorage.getItem('zl_teachers');
                const savedStudents = localStorage.getItem('zl_students');
                const savedResults = localStorage.getItem('zl_results');
                
                if (savedUser) {
                    this.user = JSON.parse(savedUser);
                }
                
                if (savedCourses) {
                    this.courses = JSON.parse(savedCourses);
                }
                
                if (savedStudents) {
                    this.students = JSON.parse(savedStudents);
                }
                
                if (savedResults) {
                    this.results = JSON.parse(savedResults);
                }
                
                // Initialize empty data if not exists
                if (!savedTeachers) {
                    this.teachers = [];
                    localStorage.setItem('zl_teachers', JSON.stringify([]));
                } else {
                    this.teachers = JSON.parse(savedTeachers);
                }
                
                // Initialize sample data for demo only if no data exists
                if (this.courses.length === 0 && this.students.length === 0) {
                    this.initializeSampleData();
                }
            },
            
            // Save data to localStorage
            saveToStorage() {
                localStorage.setItem('zl_user', JSON.stringify(this.user));
                localStorage.setItem('zl_courses', JSON.stringify(this.courses));
                localStorage.setItem('zl_students', JSON.stringify(this.students));
                localStorage.setItem('zl_results', JSON.stringify(this.results));
                localStorage.setItem('zl_teachers', JSON.stringify(this.teachers));
            },
            
            // Initialize sample data for demo
            initializeSampleData() {
                // Only create sample courses, no sample students or teachers
            
                
                this.saveToStorage();
            },
            
            // Setup event listeners
            setupEventListeners() {
                // Login modal
                document.getElementById('close-login-modal').addEventListener('click', () => {
                    this.hideLoginModal();
                });
                
                // Course modal
                document.getElementById('close-course-modal').addEventListener('click', () => {
                    this.hideCourseModal();
                });
                
                document.getElementById('cancel-course').addEventListener('click', () => {
                    this.hideCourseModal();
                });
                
                document.getElementById('save-course').addEventListener('click', () => {
                    this.saveCourse();
                });
                
                // Course image preview
                document.getElementById('course-image').addEventListener('change', (e) => {
                    this.previewCourseImage(e.target);
                });
                
                // Lesson modal
                document.getElementById('close-lesson-modal').addEventListener('click', () => {
                    this.hideLessonModal();
                });
                
                document.getElementById('cancel-lesson').addEventListener('click', () => {
                    this.hideLessonModal();
                });
                
                document.getElementById('save-lesson').addEventListener('click', () => {
                    this.saveLesson();
                });
                
                // Lesson file upload
                document.getElementById('browse-lesson-file').addEventListener('click', () => {
                    document.getElementById('lesson-file').click();
                });
                
                document.getElementById('lesson-file').addEventListener('change', (e) => {
                    this.handleLessonFileUpload(e.target.files[0]);
                });
                
                // Exercise modal
                document.getElementById('close-exercise-modal').addEventListener('click', () => {
                    this.hideExerciseModal();
                });
                
                document.getElementById('cancel-exercise').addEventListener('click', () => {
                    this.hideExerciseModal();
                });
                
                document.getElementById('save-exercise').addEventListener('click', () => {
                    this.saveExercise();
                });
                
                // Exercise image upload
                document.getElementById('browse-exercise-image').addEventListener('click', () => {
                    document.getElementById('exercise-image').click();
                });
                
                document.getElementById('exercise-image').addEventListener('change', (e) => {
                    this.handleExerciseImageUpload(e.target.files[0]);
                });
                
                // AI exercise generation - language selector
                document.querySelectorAll('.lang-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('active'));
                        e.target.classList.add('active');
                        this.currentLanguage = e.target.dataset.lang;
                        this.updateAIPromptPlaceholder();
                    });
                });
                
                // AI example prompts
                document.querySelectorAll('.example-item').forEach(example => {
                    example.addEventListener('click', (e) => {
                        const promptText = e.currentTarget.dataset.example;
                        document.getElementById('ai-prompt').value = promptText;
                    });
                });
                
                document.getElementById('generate-exercise').addEventListener('click', () => {
                    this.generateAIExercise();
                });
                
                document.getElementById('use-ai-exercise').addEventListener('click', () => {
                    this.useAIExercise();
                });
                
                // Upload modal
                document.getElementById('close-upload-modal').addEventListener('click', () => {
                    this.hideUploadModal();
                });
                
                document.getElementById('cancel-upload').addEventListener('click', () => {
                    this.hideUploadModal();
                });
                
                document.getElementById('browse-file').addEventListener('click', () => {
                    document.getElementById('csv-file').click();
                });
                
                document.getElementById('csv-file').addEventListener('change', (e) => {
                    this.handleCSVUpload(e.target.files[0]);
                });
                
                document.getElementById('download-template').addEventListener('click', () => {
                    this.downloadCSVTemplate();
                });
                
                document.getElementById('export-students').addEventListener('click', () => {
                    this.exportStudentsCSV();
                });
                
                document.getElementById('export-teachers').addEventListener('click', () => {
                    this.exportTeachersCSV();
                });
                
                document.getElementById('export-results').addEventListener('click', () => {
                    this.exportResultsCSV();
                });
                
                // Refresh buttons
                document.getElementById('refresh-students')?.addEventListener('click', () => {
                    this.showStudentsList();
                });
                
                document.getElementById('refresh-teachers')?.addEventListener('click', () => {
                    this.showTeachersList();
                });
                
                document.getElementById('refresh-results')?.addEventListener('click', () => {
                    this.showResultsList();
                });
                
                // Upload drop area
                const dropArea = document.getElementById('upload-drop-area');
                dropArea.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    dropArea.style.borderColor = 'var(--main-title)';
                    dropArea.style.backgroundColor = '#E9ECEF';
                });
                
                dropArea.addEventListener('dragleave', (e) => {
                    e.preventDefault();
                    dropArea.style.borderColor = '#6C757D';
                    dropArea.style.backgroundColor = '#F8F9FA';
                });
                
                dropArea.addEventListener('drop', (e) => {
                    e.preventDefault();
                    dropArea.style.borderColor = '#6C757D';
                    dropArea.style.backgroundColor = '#F8F9FA';
                    
                    const files = e.dataTransfer.files;
                    if (files.length > 0) {
                        this.handleCSVUpload(files[0]);
                    }
                });
                
                // Logout button
                document.getElementById('logout-btn').addEventListener('click', () => {
                    this.logout();
                });
                
                // Toggle sidebar
                document.getElementById('toggle-sidebar').addEventListener('click', () => {
                    this.toggleSidebar();
                });
                
                // Floating video controls
                document.getElementById('minimize-video').addEventListener('click', () => {
                    this.toggleFloatingVideo();
                });
                
                document.getElementById('close-video').addEventListener('click', () => {
                    this.hideFloatingVideo();
                });
                
                // Floating video drag functionality
                const floatingVideo = document.getElementById('floating-video');
                const floatingVideoHeader = document.getElementById('floating-video-header');
                
                floatingVideoHeader.addEventListener('mousedown', (e) => {
                    this.startDragFloatingVideo(e);
                });
                
                document.addEventListener('mousemove', (e) => {
                    if (this.floatingVideoDrag.isDragging) {
                        this.dragFloatingVideo(e);
                    }
                });
                
                document.addEventListener('mouseup', () => {
                    this.stopDragFloatingVideo();
                });
                
                // Touch events for mobile
                floatingVideoHeader.addEventListener('touchstart', (e) => {
                    this.startDragFloatingVideo(e.touches[0]);
                });
                
                document.addEventListener('touchmove', (e) => {
                    if (this.floatingVideoDrag.isDragging) {
                        this.dragFloatingVideo(e.touches[0]);
                    }
                });
                
                document.addEventListener('touchend', () => {
                    this.stopDragFloatingVideo();
                });
                
                // Login form submissions
                document.getElementById('student-login-form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.loginStudent();
                });
                
                document.getElementById('teacher-login-form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.loginTeacher();
                });
                
                document.getElementById('teacher-register-form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.registerTeacher();
                });
                
                // Tab switching in login modal
                document.querySelectorAll('[data-tab]').forEach(tab => {
                    tab.addEventListener('click', (e) => {
                        const tabId = e.target.dataset.tab;
                        this.switchLoginTab(tabId);
                    });
                });
                
                // Tab switching in upload modal
                document.querySelectorAll('#upload-modal [data-tab]').forEach(tab => {
                    tab.addEventListener('click', (e) => {
                        const tabId = e.target.dataset.tab;
                        this.switchUploadTab(tabId);
                    });
                });
                
                // Preview image modal
                document.getElementById('close-preview-modal')?.addEventListener('click', () => {
                    this.hideModal('preview-image-modal');
                });
            },
            
            // Floating video drag functionality
          startDragFloatingVideo(e) {
    if (this.jitsi.minimized) return;

    const floatingVideo = document.getElementById('floating-video');
    this.floatingVideoDrag.isDragging = true;

    this.floatingVideoDrag.offsetX = e.clientX - floatingVideo.offsetLeft;
    this.floatingVideoDrag.offsetY = e.clientY - floatingVideo.offsetTop;

    floatingVideo.classList.add('dragging');
},
            
            dragFloatingVideo(e) {
                const floatingVideo = document.getElementById('floating-video');
                floatingVideo.style.left = (e.clientX - this.floatingVideoDrag.offsetX) + 'px';
                floatingVideo.style.top = (e.clientY - this.floatingVideoDrag.offsetY) + 'px';
                floatingVideo.style.right = 'auto';
                floatingVideo.style.bottom = 'auto';
            },
            
            stopDragFloatingVideo() {
                this.floatingVideoDrag.isDragging = false;
                const floatingVideo = document.getElementById('floating-video');
                floatingVideo.classList.remove('dragging');
            },
            
            // ============================================
            // AUTHENTICATION FUNCTIONS
            // ============================================
            
            // Student login
            loginStudent() {
                const name = document.getElementById('student-name').value;
                const email = document.getElementById('student-email').value;
                const termsAccepted = document.getElementById('student-terms').checked;
                
                if (!name || !termsAccepted) {
                    this.showAlert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡∏¢‡∏≠‡∏°‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç', 'warning');
                    return;
                }
                
                // Check if student exists
                let student = this.students.find(s => s.fullname === name);
                
                if (!student) {
                    // Create new student with ZLS prefix
                    const studentId = 'ZLS' + (this.students.length + 1).toString().padStart(3, '0');
                    student = {
                        id: studentId,
                        fullname: name,
                        email: email || '',
                        phone: '',
                        status: 'active',
                        registeredDate: new Date().toISOString(),
                        lastLogin: new Date().toISOString()
                    };
                    this.students.push(student);
                    this.saveToStorage();
                    
                    // Update CSV data for export
                    this.updateCSVData();
                } else {
                    // Update last login
                    student.lastLogin = new Date().toISOString();
                    this.saveToStorage();
                }
                
                this.user = {
                    id: student.id,
                    name: student.fullname,
                    role: 'student',
                    email: student.email,
                    phone: student.phone || '',
                    hasAttendedLive: false
                };
                
                this.saveToStorage();
                this.hideLoginModal();
                this.showDashboard();
                this.showAlert(`‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö ${name}! ‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠: ${student.id}`, 'success');
                
                // 3. ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠ ‡∏Å‡∏î‡∏¢‡∏¥‡∏ô‡∏¢‡∏≠‡∏°‡∏•‡πá‡∏≠‡∏Ñ‡∏≠‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß ‡πÉ‡∏´‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏±‡∏ô‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
                this.showStudentHome();
            },
            
            // Teacher login
            loginTeacher() {
                const username = document.getElementById('teacher-username').value;
                const password = this.md5(document.getElementById('teacher-password').value);
                
                const teacher = this.teachers.find(t => t.username === username && t.password === password);
                
                if (teacher) {
                    // Update last login
                    teacher.lastLogin = new Date().toISOString();
                    this.saveToStorage();
                    
                    this.user = {
                        id: teacher.id,
                        name: teacher.fullname,
                        role: 'teacher',
                        email: teacher.email,
                        phone: teacher.phone || '',
                        hasAttendedLive: true
                    };
                    
                    this.saveToStorage();
                    this.hideLoginModal();
                    this.showDashboard();
                    this.showAlert(`‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏£‡∏π ${teacher.fullname}!`, 'success');
                } else {
                    this.showAlert('Username ‡∏´‡∏£‡∏∑‡∏≠ Password ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á', 'danger');
                }
            },
            
            // Teacher registration
            registerTeacher() {
                const fullname = document.getElementById('teacher-fullname').value;
                const email = document.getElementById('teacher-email').value;
                const phone = document.getElementById('teacher-phone').value;
                const username = document.getElementById('teacher-username-reg').value;
                const password = document.getElementById('teacher-password-reg').value;
                const termsAccepted = document.getElementById('teacher-terms').checked;
                
                if (!fullname || !email || !username || !password || !termsAccepted) {
                    this.showAlert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô‡πÅ‡∏•‡∏∞‡∏¢‡∏≠‡∏°‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç', 'warning');
                    return;
                }
                
                // Check if username already exists
                if (this.teachers.some(t => t.username === username)) {
                    this.showAlert('Username ‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏ä‡πâ‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏∑‡πà‡∏ô', 'danger');
                    return;
                }
                
                // Generate teacher ID
                const teacherId = 'T' + (this.teachers.length + 1).toString().padStart(3, '0');
                
                const newTeacher = {
                    id: teacherId,
                    username: username,
                    password: this.md5(password),
                    fullname: fullname,
                    email: email,
                    phone: phone,
                    role: 'teacher',
                    registeredDate: new Date().toISOString(),
                    lastLogin: new Date().toISOString()
                };
                
                this.teachers.push(newTeacher);
                this.saveToStorage();
                
                // Update CSV data for export
                this.updateCSVData();
                
                // Auto login after registration
                this.user = {
                    id: teacherId,
                    name: fullname,
                    role: 'teacher',
                    email: email,
                    phone: phone,
                    hasAttendedLive: true
                };
                
                this.saveToStorage();
                this.hideLoginModal();
                this.showDashboard();
                this.showAlert(`‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏Ñ‡∏£‡∏π‡∏ú‡∏π‡πâ‡∏™‡∏≠‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! Username: ${username} ‡∏£‡∏´‡∏±‡∏™‡∏Ñ‡∏£‡∏π: ${teacherId}`, 'success');
            },
            
            // Logout
            logout() {
                // Disconnect from Jitsi
                if (this.jitsi.api) {
                    this.jitsi.api.dispose();
                }
                if (this.jitsi.floatingApi) {
                    this.jitsi.floatingApi.dispose();
                }
                
                this.user = {
                    id: null,
                    name: '',
                    role: null,
                    email: '',
                    phone: '',
                    hasAttendedLive: false
                };
                
                this.currentCourse = null;
                this.currentPage = 'home';
                this.jitsi.connected = false;
                this.jitsi.api = null;
                this.jitsi.floatingApi = null;
                
                this.saveToStorage();
                this.showDashboard();
                this.showLoginModal();
            },
            
            // ============================================
            // JITSI MEET INTEGRATION - FIXED VIDEO ISSUE
            // ============================================
            
            // Initialize Jitsi Meet
            initJitsi(containerId, roomName, displayName, configOverrides = {}) {
                const domain = 'meet.jit.si';
                
                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö container ‡πÅ‡∏•‡∏∞‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤
                const container = document.getElementById(containerId);
                if (!container) {
                    console.error('Container not found:', containerId);
                    return null;
                }
                
                // ‡∏•‡πâ‡∏≤‡∏á container ‡∏Å‡πà‡∏≠‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà
                container.innerHTML = '';
                
                const options = {
                    roomName: roomName,
                    width: '100%',
                    height: '100%',
                    parentNode: container,
                    userInfo: {
                        displayName: displayName
                    },
                    configOverwrite: {
                        // ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°
                        startAudioOnly: false,
                        startWithAudioMuted: false,
                        startWithVideoMuted: false,
                        enableWelcomePage: false,
                        enableClosePage: false,
                        disableDeepLinking: true,
                        disableInviteFunctions: true,
                        prejoinPageEnabled: false,
                        // ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡πâ‡∏ß
                        videoQuality: {
                            preferredCodec: 'h264',
                            maxBitrates: {
                                low: 200000,
                                standard: 500000,
                                high: 1500000
                            }
                        },
                        constraints: {
                            video: {
                                aspectRatio: 16/9,
                                height: {
                                    ideal: 720,
                                    max: 720,
                                    min: 180
                                }
                            }
                        },
                        resolution: 720,
                        maxFullResolutionParticipants: 2,
                        disableSimulcast: false,
                        enableLayerSuspension: true,
                        startScreenSharing: false,
                        // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á‡∏†‡∏≤‡∏û‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô
                        disableAudioLevels: false,
                        enableNoAudioDetection: false,
                        enableNoisyMicDetection: false,
                        // ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠
                        enableP2P: true,
                        p2p: {
                            enabled: true,
                            stunServers: [
                                { urls: 'stun:stun.l.google.com:19302' },
                                { urls: 'stun:stun1.l.google.com:19302' }
                            ]
                        },
                        // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ interface
                        hideConferenceSubject: true,
                        hideConferenceTimer: false,
                        ...configOverrides
                    },
                    interfaceConfigOverwrite: {
                        // ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á interface ‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°
                        TOOLBAR_BUTTONS: [
                            'microphone', 'camera', 'closedcaptions', 'desktop', 'fullscreen',
                            'fodeviceselection', 'hangup', 'profile', 'chat', 'recording',
                            'livestreaming', 'settings', 'raisehand', 'videoquality', 'filmstrip',
                            'invite', 'feedback', 'stats', 'shortcuts', 'tileview', 'videobackgroundblur',
                            'download', 'help', 'mute-everyone', 'security'
                        ],
                        SETTINGS_SECTIONS: ['devices', 'language', 'moderator', 'profile'],
                        SHOW_CHROME_EXTENSION_BANNER: false,
                        SHOW_JITSI_WATERMARK: false,
                        SHOW_WATERMARK_FOR_GUESTS: false,
                        SHOW_BRAND_WATERMARK: false,
                        DEFAULT_BACKGROUND: '#000000',
                        // ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠
                        VIDEO_LAYOUT_FIT: 'both',
                        filmStripOnly: false,
                        VERTICAL_FILMSTRIP: false,
                        TILE_VIEW_MAX_COLUMNS: 3,
                        // ‡∏ã‡πà‡∏≠‡∏ô‡∏≠‡∏á‡∏Ñ‡πå‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô
                        MOBILE_APP_PROMO: false,
                        HIDE_INVITE_MORE_HEADER: true,
                        DISABLE_VIDEO_BACKGROUND: false
                    }
                };
                
                try {
                    console.log('Initializing Jitsi with options:', options);
                    
                    const api = new JitsiMeetExternalAPI(domain, options);
                    
                    // Add event listeners
                    api.addEventListeners({
                        readyToClose: () => {
                            console.log('Jitsi ready to close');
                            api.dispose();
                            this.jitsi.connected = false;
                            if (containerId === 'jitsi-container-floating') {
                                this.jitsi.floatingApi = null;
                            } else {
                                this.jitsi.api = null;
                            }
                            this.showAlert('‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÅ‡∏•‡πâ‡∏ß', 'info');
                        },
                        videoConferenceJoined: () => {
                            console.log('Video conference joined');
                            this.jitsi.connected = true;
                            this.user.hasAttendedLive = true;
                            this.saveToStorage();
                            
                            // Hide placeholder
                            const placeholder = document.querySelector(
                                containerId === 'jitsi-container-floating' 
                                ? '#floating-video-placeholder' 
                                : '.video-placeholder'
                            );
                            if (placeholder) {
                                placeholder.style.display = 'none';
                            }
                            
                            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
                            setTimeout(() => {
                                this.checkVideoStatus(api);
                            }, 2000);
                            
                            this.showAlert('‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
                        },
                        videoConferenceLeft: () => {
                            console.log('Video conference left');
                            this.jitsi.connected = false;
                            
                            // Show placeholder
                            const placeholder = document.querySelector(
                                containerId === 'jitsi-container-floating' 
                                ? '#floating-video-placeholder' 
                                : '.video-placeholder'
                            );
                            if (placeholder) {
                                placeholder.style.display = 'flex';
                            }
                        },
                        participantJoined: (participant) => {
                            console.log('Participant joined:', participant.displayName);
                            this.showAlert(`‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ ${participant.displayName} ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô`, 'info');
                        },
                        participantLeft: (participant) => {
                            console.log('Participant left:', participant.displayName);
                            this.showAlert(`‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ ${participant.displayName} ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô`, 'warning');
                        },
                        cameraError: (error) => {
                            console.error('Camera error:', error);
                            this.showAlert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏Å‡∏±‡∏ö‡∏Å‡∏•‡πâ‡∏≠‡∏á ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏•‡πâ‡∏≠‡∏á', 'danger');
                        },
                        micError: (error) => {
                            console.error('Microphone error:', error);
                            this.showAlert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏Å‡∏±‡∏ö‡πÑ‡∏°‡πÇ‡∏Ñ‡∏£‡πÇ‡∏ü‡∏ô ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÑ‡∏°‡πÇ‡∏Ñ‡∏£‡πÇ‡∏ü‡∏ô', 'danger');
                        },
                        error: (error) => {
                            console.error('Jitsi error:', error);
                            this.showAlert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô', 'danger');
                        }
                    });
                    
                    return api;
                } catch (error) {
                    console.error('Failed to initialize Jitsi:', error);
                    this.showAlert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á', 'danger');
                    return null;
                }
            },
            
            // Check video status
            checkVideoStatus(api) {
                if (!api) return;
                
                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠
                api.isVideoMuted()
                    .then((muted) => {
                        console.log('Video muted status:', muted);
                        if (muted) {
                            // ‡∏ñ‡πâ‡∏≤‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏õ‡∏¥‡∏î‡∏≠‡∏¢‡∏π‡πà ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡∏¥‡∏î
                            api.executeCommand('toggleVideo');
                            this.showAlert('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á...', 'info');
                        }
                    })
                    .catch(console.error);
                
                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏™‡∏µ‡∏¢‡∏á
                api.isAudioMuted()
                    .then((muted) => {
                        console.log('Audio muted status:', muted);
                    })
                    .catch(console.error);
            },
            
            connectToJitsi(roomName, displayName, target = 'main') {
    console.log('Connecting to Jitsi:', { roomName, displayName, target });

    // -----------------------------
    // 1. Dispose instance ‡πÄ‡∏î‡∏¥‡∏° (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
    // -----------------------------
    if (this.jitsi.api) {
        try {
            this.jitsi.api.dispose();
        } catch (e) {
            console.warn('Dispose error:', e);
        }
        this.jitsi.api = null;
    }

    // -----------------------------
    // 2. ‡∏Å‡∏≥‡∏´‡∏ô‡∏î container
    // -----------------------------
    const containerId =
        target === 'floating'
            ? 'jitsi-container-floating'
            : 'jitsi-container';

    const container = document.getElementById(containerId);
    if (!container) {
        console.error('Jitsi container not found:', containerId);
        return;
    }

    // ‡∏•‡πâ‡∏≤‡∏á iframe ‡πÄ‡∏Å‡πà‡∏≤
    container.innerHTML = '';

    // -----------------------------
    // 3. ‡πÅ‡∏™‡∏î‡∏á placeholder
    // -----------------------------
    const placeholder = document.querySelector(
        target === 'floating'
            ? '#floating-video-placeholder'
            : '.video-placeholder'
    );
    if (placeholder) {
        placeholder.style.display = 'flex';
    }

    // -----------------------------
    // 4. Init Jitsi ‡πÉ‡∏´‡∏°‡πà
    // -----------------------------
    const api = this.initJitsi(containerId, roomName, displayName);
    if (!api) {
        this.showAlert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÑ‡∏î‡πâ', 'danger');
        return;
    }

    // -----------------------------
    // 5. ‡πÄ‡∏Å‡πá‡∏ö state
    // -----------------------------
    this.jitsi.api = api;
    this.jitsi.roomName = roomName;
    this.jitsi.displayName = displayName;
    this.jitsi.floating = target === 'floating';
    this.jitsi.minimized = false;

    // -----------------------------
    // 6. ‡πÅ‡∏™‡∏î‡∏á / ‡∏ã‡πà‡∏≠‡∏ô floating container
    // -----------------------------
    const floatingVideo = document.getElementById('floating-video');
    if (target === 'floating') {
        floatingVideo.classList.remove('hidden');
        floatingVideo.style.display = 'block';
    } else {
        floatingVideo.classList.add('hidden');
    }

    // -----------------------------
    // 7. ‡πÅ‡∏à‡πâ‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠
    // -----------------------------
    setTimeout(() => {
        if (!this.jitsi.connected) {
            this.showAlert('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô...', 'info');
        }
    }, 2000);
},
            // Disconnect from Jitsi
            disconnectFromJitsi() {
                console.log('Disconnecting from Jitsi');
                
                if (this.jitsi.api) {
                    this.jitsi.api.executeCommand('hangup');
                    setTimeout(() => {
                        this.jitsi.api.dispose();
                    }, 1000);
                    this.jitsi.api = null;
                }
                
                if (this.jitsi.floatingApi) {
                    this.jitsi.floatingApi.executeCommand('hangup');
                    setTimeout(() => {
                        this.jitsi.floatingApi.dispose();
                    }, 1000);
                    this.jitsi.floatingApi = null;
                }
                
                this.jitsi.connected = false;
                this.jitsi.floating = false;
                
                // Hide floating video
                this.hideFloatingVideo();
                
                // Show placeholders
                const mainPlaceholder = document.querySelector('.video-placeholder');
                const floatingPlaceholder = document.getElementById('floating-video-placeholder');
                
                if (mainPlaceholder) {
                    mainPlaceholder.style.display = 'flex';
                }
                if (floatingPlaceholder) {
                    floatingPlaceholder.style.display = 'flex';
                }
                
                this.showAlert('‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÅ‡∏•‡πâ‡∏ß', 'info');
            },
            
        // ============================================
// TOGGLE FLOATING VIDEO (MINIMIZE / RESTORE)
// ============================================
toggleFloatingVideo() {
    const video = document.getElementById('floating-video');
    const container = document.getElementById('jitsi-container-floating');

    if (!video || !container) return;

    this.jitsi.minimized = !this.jitsi.minimized;

    if (this.jitsi.minimized) {
        container.style.display = 'none';
        video.classList.add('minimized');
    } else {
        container.style.display = 'block';
        video.classList.remove('minimized');
    }
},

// ============================================
// SHOW FLOATING VIDEO (FIXED)
// ============================================
showFloatingVideo() {
    const video = document.getElementById('floating-video');

    // ‡πÅ‡∏™‡∏î‡∏á floating container
    this.jitsi.floating = true;
    this.jitsi.minimized = false;

    video.classList.remove('hidden');
    video.style.display = 'block';

    // ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
    video.style.right = '20px';
    video.style.bottom = '20px';

    // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß ‚Üí ‡∏¢‡πâ‡∏≤‡∏¢ Jitsi ‡∏°‡∏≤‡∏ó‡∏µ‡πà floating
    if (this.jitsi.roomName) {
        this.connectToJitsi(
            this.jitsi.roomName,
            this.user.name,
            'floating'
        );
    }
},

            // ============================================
// HIDE FLOATING VIDEO (BACK TO MAIN)
// ============================================
hideFloatingVideo() {
    const video = document.getElementById('floating-video');

    if (!this.jitsi.roomName) {
        video.classList.add('hidden');
        return;
    }

    this.jitsi.floating = false;
    this.jitsi.minimized = false;

    video.classList.add('hidden');

    // ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡∏î (video ‡πÉ‡∏´‡∏ç‡πà)
    this.connectToJitsi(
        this.jitsi.roomName,
        this.user.name,
        'main'
    );
},

            
            // ============================================
            // CSV MANAGEMENT FUNCTIONS - IMPROVED
            // ============================================
            
            // Handle CSV file upload
            handleCSVUpload(file) {
                if (!file) {
                    this.showAlert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå', 'warning');
                    return;
                }
                
                if (!file.name.endsWith('.csv')) {
                    this.showAlert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå CSV ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô', 'danger');
                    return;
                }
                
                // Show file info
                this.showFileUploadInfo(file);
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    const content = e.target.result;
                    this.parseCSV(content, file);
                };
                reader.onerror = () => {
                    this.showAlert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏î‡πâ', 'danger');
                };
                reader.readAsText(file, 'UTF-8');
            },
            
            // Show file upload info
            showFileUploadInfo(file) {
                const fileInfoDiv = document.getElementById('file-upload-info');
                const fileNameSpan = document.getElementById('uploaded-file-name');
                const fileStatusText = document.getElementById('file-status-text');
                const fileDetailsDiv = document.getElementById('file-details');
                
                fileNameSpan.textContent = file.name;
                fileStatusText.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÑ‡∏ü‡∏•‡πå...';
                
                // Show file details
                fileDetailsDiv.innerHTML = `
                    <p><strong>‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏ü‡∏•‡πå:</strong> ${this.formatFileSize(file.size)}</p>
                    <p><strong>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó:</strong> CSV</p>
                    <p><strong>‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏°‡∏∑‡πà‡∏≠:</strong> ${new Date().toLocaleTimeString('th-TH')}</p>
                `;
                
                fileInfoDiv.classList.remove('hidden');
                document.getElementById('upload-preview').classList.add('hidden');
                document.getElementById('confirm-upload').classList.remove('hidden');
            },
            
            // Format file size
            formatFileSize(bytes) {
                if (bytes === 0) return '0 Bytes';
                const k = 1024;
                const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
            },
            
            // Parse CSV content
            parseCSV(csvContent, file) {
                try {
                    const lines = csvContent.split('\n').filter(line => line.trim() !== '');
                    const fileStatusText = document.getElementById('file-status-text');
                    
                    // Check if file is empty or has only headers
                    if (lines.length === 0) {
                        fileStatusText.textContent = '‡πÑ‡∏ü‡∏•‡πå CSV ‡πÄ‡∏õ‡∏•‡πà‡∏≤ - ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö';
                        fileStatusText.style.color = 'var(--info-color)';
                        this.uploadedCSVData = [];
                        this.showCSVPreview([], true);
                        return;
                    }
                    
                    // Check if file has only headers or data
                    const headers = lines[0].split(',').map(h => h.trim().toLowerCase());
                    
                    // Parse data rows
                    const data = [];
                    for (let i = 1; i < lines.length; i++) {
                        const values = lines[i].split(',').map(v => v.trim());
                        const row = {};
                        
                        headers.forEach((header, index) => {
                            row[header] = values[index] || '';
                        });
                        
                        // Only add row if it has at least one non-empty value
                        if (Object.values(row).some(v => v !== '')) {
                            data.push(row);
                        }
                    }
                    
                    fileStatusText.textContent = data.length > 0 
                        ? `‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ${data.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå`
                        : '‡πÑ‡∏ü‡∏•‡πå CSV ‡πÄ‡∏õ‡∏•‡πà‡∏≤ - ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö';
                    fileStatusText.style.color = data.length > 0 ? 'var(--success-color)' : 'var(--info-color)';
                    
                    // Display preview
                    this.showCSVPreview(data, data.length === 0);
                } catch (error) {
                    console.error('CSV parsing error:', error);
                    // Even if parsing fails, allow empty file
                    this.uploadedCSVData = [];
                    const fileStatusText = document.getElementById('file-status-text');
                    fileStatusText.textContent = '‡πÑ‡∏ü‡∏•‡πå CSV ‡πÄ‡∏õ‡∏•‡πà‡∏≤ - ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö';
                    fileStatusText.style.color = 'var(--info-color)';
                    this.showCSVPreview([], true);
                }
            },
            
            // Show CSV preview
            showCSVPreview(data, isEmptyFile = false) {
                const tableBody = document.querySelector('#preview-table tbody');
                tableBody.innerHTML = '';
                
                if (data.length > 0) {
                    data.slice(0, 10).forEach(row => {
                        const tr = document.createElement('tr');
                        tr.innerHTML = `
                            <td>${row.‡∏£‡∏´‡∏±‡∏™ || row.id || ''}</td>
                            <td>${row.‡∏ä‡∏∑‡πà‡∏≠ || row.name || row.fullname || ''}</td>
                            <td>${row.‡∏≠‡∏µ‡πÄ‡∏°‡∏• || row.email || ''}</td>
                            <td>${row.‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó || row.type || '‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô'}</td>
                            <td><span class="badge ${(row.‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ || row.status) === 'active' ? 'badge-success' : 'badge-warning'}">${row.‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ || row.status || 'active'}</span></td>
                        `;
                        tableBody.appendChild(tr);
                    });
                    
                    document.getElementById('upload-preview').classList.remove('hidden');
                } else {
                    // Show empty message
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td colspan="5" class="text-center text-muted">
                            <i class="fas fa-info-circle"></i> ${isEmptyFile ? '‡πÑ‡∏ü‡∏•‡πå CSV ‡πÄ‡∏õ‡∏•‡πà‡∏≤ - ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö' : '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå CSV ‡∏ô‡∏µ‡πâ'}
                        </td>
                    `;
                    tableBody.appendChild(tr);
                    
                    document.getElementById('upload-preview').classList.remove('hidden');
                }
                
                document.getElementById('record-count').textContent = data.length;
                
                // Store data for saving
                this.uploadedCSVData = data;
                
                // Update confirm button text based on file content
                const confirmBtn = document.getElementById('confirm-upload');
                if (data.length === 0) {
                    confirmBtn.textContent = '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏õ‡∏•‡πà‡∏≤‡πÅ‡∏•‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö';
                } else {
                    confirmBtn.textContent = '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•';
                }
                
                // Add event listener for confirm button
                confirmBtn.onclick = () => {
                    this.saveCSVData();
                };
            },
            
            // Save uploaded CSV data
            saveCSVData() {
                // Mark system as initialized
                localStorage.setItem('zl_has_initial_data', 'true');
                
                // Store file info
                this.uploadedFileInfo = {
                    fileName: document.getElementById('uploaded-file-name').textContent,
                    uploadTime: new Date().toISOString(),
                    recordCount: this.uploadedCSVData?.length || 0,
                    isEmpty: this.uploadedCSVData?.length === 0
                };
                
                // Process data if exists
                if (this.uploadedCSVData && this.uploadedCSVData.length > 0) {
                    // Process each row
                    this.uploadedCSVData.forEach(row => {
                        if (row.‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó === '‡∏Ñ‡∏£‡∏π' || row.type === 'teacher') {
                            // Process teacher
                            this.processTeacherRow(row);
                        } else {
                            // Process student
                            this.processStudentRow(row);
                        }
                    });
                }
                
                this.saveToStorage();
                this.hideUploadModal();
                
                // Show appropriate message
                if (this.uploadedCSVData?.length === 0) {
                    this.showAlert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ü‡∏•‡πå CSV ‡πÄ‡∏õ‡∏•‡πà‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢! ‡∏£‡∏∞‡∏ö‡∏ö‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô', 'success');
                } else {
                    this.showAlert(`‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ (${this.uploadedCSVData?.length || 0} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)`, 'success');
                }
                
                // Now show login modal
                setTimeout(() => {
                    this.showLoginModal();
                }, 1000);
            },
            
            // Process teacher row
            processTeacherRow(row) {
                const existingIds = new Set(this.teachers.map(t => t.id));
                const teacherId = row.‡∏£‡∏´‡∏±‡∏™ || row.id || 'T' + (this.teachers.length + 1).toString().padStart(3, '0');
                
                if (!existingIds.has(teacherId)) {
                    const teacher = {
                        id: teacherId,
                        username: row.‡∏¢‡∏π‡∏™‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÄ‡∏ô‡∏° || row.username || row.‡∏£‡∏´‡∏±‡∏™?.toLowerCase() || `teacher${this.teachers.length + 1}`,
                        password: this.md5(row.‡∏£‡∏´‡∏±‡∏™ || row.id || 'password123'), // Default password
                        fullname: row.‡∏ä‡∏∑‡πà‡∏≠ || row.name || row.fullname || '‡∏Ñ‡∏£‡∏π‡∏ú‡∏π‡πâ‡∏™‡∏≠‡∏ô',
                        email: row.‡∏≠‡∏µ‡πÄ‡∏°‡∏• || row.email || '',
                        phone: row.‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå || row.phone || '',
                        role: 'teacher',
                        registeredDate: new Date().toISOString(),
                        lastLogin: null
                    };
                    
                    this.teachers.push(teacher);
                }
            },
            
            // Process student row
            processStudentRow(row) {
                const existingIds = new Set(this.students.map(s => s.id));
                const studentId = row.‡∏£‡∏´‡∏±‡∏™ || row.id || 'ZLS' + (this.students.length + 1).toString().padStart(3, '0');
                
                if (!existingIds.has(studentId)) {
                    const student = {
                        id: studentId,
                        fullname: row.‡∏ä‡∏∑‡πà‡∏≠ || row.name || row.fullname || '‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô',
                        email: row.‡∏≠‡∏µ‡πÄ‡∏°‡∏• || row.email || '',
                        phone: row.‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå || row.phone || '',
                        status: row.‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ || row.status || 'active',
                        registeredDate: new Date().toISOString(),
                        lastLogin: null
                    };
                    
                    this.students.push(student);
                }
            },
            
            // Update CSV data when new users register
            updateCSVData() {
                // This function ensures CSV data stays updated with new registrations
                // The data is already saved in localStorage, so we just need to ensure
                // it's included in future exports
                this.saveToStorage();
            },
            
            // Export students to CSV
            exportStudentsCSV() {
                // Create CSV content
                const headers = ['‡∏£‡∏´‡∏±‡∏™', '‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•', '‡∏≠‡∏µ‡πÄ‡∏°‡∏•', '‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå', '‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞', '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô', '‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î'];
                const csvContent = [
                    headers.join(','),
                    ...this.students.map(student => 
                        [
                            `"${student.id || ''}"`,
                            `"${student.fullname || ''}"`,
                            `"${student.email || ''}"`,
                            `"${student.phone || ''}"`,
                            `"${student.status || ''}"`,
                            `"${new Date(student.registeredDate).toLocaleDateString('th-TH')}"`,
                            `"${student.lastLogin ? new Date(student.lastLogin).toLocaleDateString('th-TH') : '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Ñ‡∏¢‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô'}"`
                        ].join(',')
                    )
                ].join('\n');
                
                // Create download link
                const blob = new Blob(['\uFEFF' + csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                const url = URL.createObjectURL(blob);
                
                link.setAttribute('href', url);
                link.setAttribute('download', `students_${new Date().toISOString().slice(0,10)}.csv`);
                link.style.visibility = 'hidden';
                
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                this.showAlert(`‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ${this.students.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢`, 'success');
            },
            
            // Export teachers to CSV
            exportTeachersCSV() {
                // Create CSV content
                const headers = ['‡∏£‡∏´‡∏±‡∏™', '‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•', '‡∏≠‡∏µ‡πÄ‡∏°‡∏•', '‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå', '‡∏¢‡∏π‡∏™‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÄ‡∏ô‡∏°', '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô', '‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î'];
                const csvContent = [
                    headers.join(','),
                    ...this.teachers.map(teacher => 
                        [
                            `"${teacher.id || ''}"`,
                            `"${teacher.fullname || ''}"`,
                            `"${teacher.email || ''}"`,
                            `"${teacher.phone || ''}"`,
                            `"${teacher.username || ''}"`,
                            `"${new Date(teacher.registeredDate).toLocaleDateString('th-TH')}"`,
                            `"${teacher.lastLogin ? new Date(teacher.lastLogin).toLocaleDateString('th-TH') : '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Ñ‡∏¢‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô'}"`
                        ].join(',')
                    )
                ].join('\n');
                
                // Create download link
                const blob = new Blob(['\uFEFF' + csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                const url = URL.createObjectURL(blob);
                
                link.setAttribute('href', url);
                link.setAttribute('download', `teachers_${new Date().toISOString().slice(0,10)}.csv`);
                link.style.visibility = 'hidden';
                
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                this.showAlert(`‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏π ${this.teachers.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢`, 'success');
            },
            
            // Export results to CSV
            exportResultsCSV() {
                // Create CSV content
                const headers = ['‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô', '‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô', '‡∏£‡∏´‡∏±‡∏™‡∏Ñ‡∏≠‡∏£‡πå‡∏™', '‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏≠‡∏£‡πå‡∏™', '‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î‡∏ó‡∏µ‡πà‡∏ó‡∏≥', '‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô', '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥'];
                const csvContent = [
                    headers.join(','),
                    ...this.results.map(result => 
                        [
                            `"${result.studentId || ''}"`,
                            `"${result.studentName || ''}"`,
                            `"${result.courseId || ''}"`,
                            `"${result.courseName || ''}"`,
                            `"${result.exerciseCount || 0}"`,
                            `"${result.score || 0}"`,
                            `"${new Date(result.date).toLocaleDateString('th-TH')}"`
                        ].join(',')
                    )
                ].join('\n');
                
                // Create download link
                const blob = new Blob(['\uFEFF' + csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                const url = URL.createObjectURL(blob);
                
                link.setAttribute('href', url);
                link.setAttribute('download', `results_${new Date().toISOString().slice(0,10)}.csv`);
                link.style.visibility = 'hidden';
                
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                this.showAlert(`‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ${this.results.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢`, 'success');
            },
            
            // Download CSV template
            downloadCSVTemplate() {
                // Create empty template with headers only
                const template = '‡∏£‡∏´‡∏±‡∏™,‡∏ä‡∏∑‡πà‡∏≠,‡∏≠‡∏µ‡πÄ‡∏°‡∏•,‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå,‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó,‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞,‡∏¢‡∏π‡∏™‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÄ‡∏ô‡∏°\n';
                
                const blob = new Blob(['\uFEFF' + template], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                const url = URL.createObjectURL(blob);
                
                link.setAttribute('href', url);
                link.setAttribute('download', 'template_empty.csv');
                link.style.visibility = 'hidden';
                
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                this.showAlert('‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏ó‡∏°‡πÄ‡∏û‡∏•‡∏ï CSV ‡πÄ‡∏õ‡∏•‡πà‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', 'success');
            },
            
            // Show students list
            showStudentsList() {
                const container = document.getElementById('students-list-container');
                
                if (this.students.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-users"></i>
                            <h4>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h4>
                            <p>‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å ‡∏´‡∏£‡∏∑‡∏≠‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå CSV</p>
                        </div>
                    `;
                    return;
                }
                
                let html = `
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</th>
                                    <th>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th>
                                    <th>‡∏≠‡∏µ‡πÄ‡∏°‡∏•</th>
                                    <th>‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</th>
                                    <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                                    <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</th>
                                    <th>‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</th>
                                    <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                                </tr>
                            </thead>
                            <tbody>
                `;
                
                this.students.forEach(student => {
                    html += `
                        <tr>
                            <td>${student.id}</td>
                            <td>${student.fullname}</td>
                            <td>${student.email || '-'}</td>
                            <td>${student.phone || '-'}</td>
                            <td><span class="badge ${student.status === 'active' ? 'badge-success' : 'badge-warning'}">${student.status}</span></td>
                            <td>${new Date(student.registeredDate).toLocaleDateString('th-TH')}</td>
                            <td>${student.lastLogin ? new Date(student.lastLogin).toLocaleDateString('th-TH') : '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Ñ‡∏¢'}</td>
                            <td>
                                <button class="btn btn-danger btn-sm" onclick="AppState.deleteStudent('${student.id}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                    `;
                });
                
                html += `
                            </tbody>
                        </table>
                    </div>
                    <div class="alert alert-info mt-20">
                        <i class="fas fa-info-circle"></i> ‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${this.students.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
                    </div>
                `;
                
                container.innerHTML = html;
            },
            
            // Show teachers list - UPDATED WITH DELETE BUTTON
            showTeachersList() {
                const container = document.getElementById('teachers-list-container');
                
                if (this.teachers.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-chalkboard-teacher"></i>
                            <h4>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏π‡∏ú‡∏π‡πâ‡∏™‡∏≠‡∏ô</h4>
                            <p>‡∏Ñ‡∏£‡∏π‡∏ú‡∏π‡πâ‡∏™‡∏≠‡∏ô‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô ‡∏´‡∏£‡∏∑‡∏≠‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå CSV</p>
                        </div>
                    `;
                    return;
                }
                
                let html = `
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>‡∏£‡∏´‡∏±‡∏™‡∏Ñ‡∏£‡∏π</th>
                                    <th>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th>
                                    <th>‡∏≠‡∏µ‡πÄ‡∏°‡∏•</th>
                                    <th>‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</th>
                                    <th>‡∏¢‡∏π‡∏™‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÄ‡∏ô‡∏°</th>
                                    <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</th>
                                    <th>‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</th>
                                    <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                                </tr>
                            </thead>
                            <tbody>
                `;
                
                this.teachers.forEach(teacher => {
                    html += `
                        <tr>
                            <td>${teacher.id}</td>
                            <td>${teacher.fullname}</td>
                            <td>${teacher.email || '-'}</td>
                            <td>${teacher.phone || '-'}</td>
                            <td>${teacher.username}</td>
                            <td>${new Date(teacher.registeredDate).toLocaleDateString('th-TH')}</td>
                            <td>${teacher.lastLogin ? new Date(teacher.lastLogin).toLocaleDateString('th-TH') : '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Ñ‡∏¢'}</td>
                            <td>
                                <div class="teacher-actions">
                                    <button class="btn btn-danger btn-sm" onclick="AppState.deleteTeacher('${teacher.id}')">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                    `;
                });
                
                html += `
                            </tbody>
                        </table>
                    </div>
                    <div class="alert alert-info mt-20">
                        <i class="fas fa-info-circle"></i> ‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏π‡∏ú‡∏π‡πâ‡∏™‡∏≠‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${this.teachers.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
                    </div>
                `;
                
                container.innerHTML = html;
            },
            
            // Show results list
            showResultsList() {
                const container = document.getElementById('results-list-container');
                
                if (this.results.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-chart-bar"></i>
                            <h4>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h4>
                            <p>‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏à‡∏∞‡∏õ‡∏£‡∏≤‡∏Å‡∏è‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏≥‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î</p>
                        </div>
                    `;
                    return;
                }
                
                let html = `
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</th>
                                    <th>‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</th>
                                    <th>‡∏£‡∏´‡∏±‡∏™‡∏Ñ‡∏≠‡∏£‡πå‡∏™</th>
                                    <th>‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏≠‡∏£‡πå‡∏™</th>
                                    <th>‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î‡∏ó‡∏µ‡πà‡∏ó‡∏≥</th>
                                    <th>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</th>
                                    <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥</th>
                                </tr>
                            </thead>
                            <tbody>
                `;
                
                this.results.slice(0, 20).forEach(result => {
                    html += `
                        <tr>
                            <td>${result.studentId}</td>
                            <td>${result.studentName}</td>
                            <td>${result.courseId}</td>
                            <td>${result.courseName}</td>
                            <td>${result.exerciseCount}</td>
                            <td>${result.score}</td>
                            <td>${new Date(result.date).toLocaleDateString('th-TH')}</td>
                        </tr>
                    `;
                });
                
                html += `
                            </tbody>
                        </table>
                    </div>
                    <div class="alert alert-info mt-20">
                        <i class="fas fa-info-circle"></i> ‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ${this.results.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
                    </div>
                `;
                
                container.innerHTML = html;
            },
            
            // Delete student
            deleteStudent(studentId) {
                if (!confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ô‡∏µ‡πâ?')) return;
                
                this.students = this.students.filter(s => s.id !== studentId);
                this.saveToStorage();
                this.showStudentsList();
                this.showAlert('‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', 'success');
            },
            
            // Delete teacher - NEW FUNCTION
            deleteTeacher(teacherId) {
                if (!confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏π‡∏ú‡∏π‡πâ‡∏™‡∏≠‡∏ô‡∏ô‡∏µ‡πâ?\n‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡∏Ñ‡∏≠‡∏£‡πå‡∏™‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏£‡∏π‡∏™‡∏≠‡∏ô‡∏≠‡∏¢‡∏π‡πà‡∏à‡∏∞‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡∏≠‡∏¢‡∏π‡πà ‡πÅ‡∏ï‡πà‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏£‡∏π‡∏ú‡∏π‡πâ‡∏™‡∏≠‡∏ô‡∏õ‡∏£‡∏≤‡∏Å‡∏è')) return;
                
                this.teachers = this.teachers.filter(t => t.id !== teacherId);
                
                // Update courses to remove teacher reference
                this.courses.forEach(course => {
                    if (course.teacherId === teacherId) {
                        course.teacherId = '';
                        course.teacherName = '‡∏Ñ‡∏£‡∏π‡∏ú‡∏π‡πâ‡∏™‡∏≠‡∏ô‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö';
                    }
                });
                
                this.saveToStorage();
                this.showTeachersList();
                this.showAlert('‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏π‡∏ú‡∏π‡πâ‡∏™‡∏≠‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', 'success');
            },
            
            // ============================================
            // AI EXERCISE GENERATION - MULTI-LANGUAGE SUPPORT
            // ============================================
            
            // Update AI prompt placeholder based on language
            updateAIPromptPlaceholder() {
                const promptBox = document.getElementById('ai-prompt');
                const previewTitle = document.getElementById('ai-preview-title');
                
                switch (this.currentLanguage) {
                    case 'english':
                        promptBox.placeholder = '‡πÄ‡∏ä‡πà‡∏ô: ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á Present Simple Tense ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏ñ‡∏°...';
                        previewTitle.textContent = '‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©‡∏ó‡∏µ‡πà AI ‡∏™‡∏£‡πâ‡∏≤‡∏á:';
                        break;
                    case 'chinese':
                        promptBox.placeholder = '‡πÄ‡∏ä‡πà‡∏ô: ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î‡∏†‡∏≤‡∏©‡∏≤‡∏à‡∏µ‡∏ô‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á ‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏ö‡πÄ‡∏•‡∏Ç 1-100 ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô...';
                        previewTitle.textContent = '‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î‡∏†‡∏≤‡∏©‡∏≤‡∏à‡∏µ‡∏ô‡∏ó‡∏µ‡πà AI ‡∏™‡∏£‡πâ‡∏≤‡∏á:';
                        break;
                    case 'thai':
                        promptBox.placeholder = '‡πÄ‡∏ä‡πà‡∏ô: ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏£‡∏≤‡∏ä‡∏≤‡∏®‡∏±‡∏û‡∏ó‡πå...';
                        previewTitle.textContent = '‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢‡∏ó‡∏µ‡πà AI ‡∏™‡∏£‡πâ‡∏≤‡∏á:';
                        break;
                }
            },
            
            // Generate AI exercise - ENHANCED VERSION
            generateAIExercise() {
                const prompt = document.getElementById('ai-prompt').value;
                
                if (!prompt || prompt.length < 10) {
                    this.showAlert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î‡πÉ‡∏´‡πâ‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏ß‡πà‡∏≤‡∏ô‡∏µ‡πâ', 'warning');
                    return;
                }
                
                // Show loading
                const generateBtn = document.getElementById('generate-exercise');
                const originalText = generateBtn.innerHTML;
                generateBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á...';
                generateBtn.disabled = true;
                
                // Enhanced AI exercise generation based on prompt
                setTimeout(() => {
                    // Parse the prompt to understand requirements
                    const promptLower = prompt.toLowerCase();
                    const isConversation = promptLower.includes('‡∏ö‡∏ó‡∏™‡∏ô‡∏ó‡∏ô‡∏≤') || promptLower.includes('‡∏™‡∏ô‡∏ó‡∏ô‡∏≤') || promptLower.includes('conversation');
                    const isVocabulary = promptLower.includes('‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå') || promptLower.includes('vocabulary') || promptLower.includes('ËØçÊ±á');
                    const isSentence = promptLower.includes('‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ') || promptLower.includes('sentence') || promptLower.includes('Âè•Â≠ê');
                    const isFillBlank = promptLower.includes('‡πÄ‡∏ï‡∏¥‡∏°‡∏Ñ‡∏≥') || promptLower.includes('fill') || promptLower.includes('Á©∫ÁôΩ');
                    const isReorder = promptLower.includes('‡πÄ‡∏£‡∏µ‡∏¢‡∏á') || promptLower.includes('reorder') || promptLower.includes('ÊéíÂ∫è');
                    
                    // Determine exercise count from prompt
                    let exerciseCount = 5; // default
                    const countMatch = prompt.match(/(\d+)\s*(‡∏Ç‡πâ‡∏≠|‰∏™|items|exercises)/);
                    if (countMatch) {
                        exerciseCount = parseInt(countMatch[1]);
                        if (exerciseCount > 10) exerciseCount = 10; // limit to 10
                    }
                    
                    // Generate exercises based on language and prompt type
                    let generatedExercises = [];
                    
                    if (this.currentLanguage === 'english') {
                        if (isConversation) {
                            generatedExercises = this.generateEnglishConversationExercises(prompt, exerciseCount);
                        } else if (isVocabulary) {
                            generatedExercises = this.generateEnglishVocabularyExercises(prompt, exerciseCount);
                        } else if (isFillBlank) {
                            generatedExercises = this.generateEnglishFillBlankExercises(prompt, exerciseCount);
                        } else {
                            generatedExercises = this.generateEnglishGeneralExercises(prompt, exerciseCount);
                        }
                    } else if (this.currentLanguage === 'chinese') {
                        if (isConversation) {
                            generatedExercises = this.generateChineseConversationExercises(prompt, exerciseCount);
                        } else if (isVocabulary) {
                            generatedExercises = this.generateChineseVocabularyExercises(prompt, exerciseCount);
                        } else if (isSentence) {
                            generatedExercises = this.generateChineseSentenceExercises(prompt, exerciseCount);
                        } else if (isFillBlank) {
                            generatedExercises = this.generateChineseFillBlankExercises(prompt, exerciseCount);
                        } else if (isReorder) {
                            generatedExercises = this.generateChineseReorderExercises(prompt, exerciseCount);
                        } else {
                            generatedExercises = this.generateChineseGeneralExercises(prompt, exerciseCount);
                        }
                    } else {
                        // Thai language
                        generatedExercises = this.generateThaiGeneralExercises(prompt, exerciseCount);
                    }
                    
                    // Display generated exercise
                    const questionElement = document.getElementById('ai-generated-question');
                    const answerElement = document.getElementById('ai-generated-answer');
                    
                    if (this.currentLanguage === 'chinese') {
                        questionElement.className = 'mb-10 chinese-font';
                        answerElement.className = 'mb-20 chinese-font';
                    } else {
                        questionElement.className = 'mb-10';
                        answerElement.className = 'mb-20';
                    }
                    
                    // Combine multiple exercises if more than one
                    let questionsHtml = '<div class="mb-10">';
                    let answersHtml = '<div class="mb-10">';
                    
                    generatedExercises.forEach((exercise, index) => {
                        questionsHtml += `<p><strong>‡∏Ç‡πâ‡∏≠ ${index + 1}:</strong> ${exercise.question}</p>`;
                        answersHtml += `<p><strong>‡πÄ‡∏â‡∏•‡∏¢‡∏Ç‡πâ‡∏≠ ${index + 1}:</strong> ${exercise.answer}</p>`;
                    });
                    
                    questionsHtml += '</div>';
                    answersHtml += '</div>';
                    
                    questionElement.innerHTML = `<strong>‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°:</strong> ${questionsHtml}`;
                    answerElement.innerHTML = `<strong>‡πÄ‡∏â‡∏•‡∏¢:</strong> ${answersHtml}`;
                    document.getElementById('ai-exercise-preview').classList.add('show');
                    
                    // Reset button
                    generateBtn.innerHTML = originalText;
                    generateBtn.disabled = false;
                    
                    this.showAlert(`‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î${this.currentLanguage === 'english' ? '‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©' : this.currentLanguage === 'chinese' ? '‡∏†‡∏≤‡∏©‡∏≤‡∏à‡∏µ‡∏ô' : '‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢'} ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! (${exerciseCount} ‡∏Ç‡πâ‡∏≠)`, 'success');
                    
                    // Store generated exercises for use
                    this.lastGeneratedExercises = generatedExercises;
                }, 2000);
            },
            
            // English exercise generators
            generateEnglishConversationExercises(prompt, count) {
                const conversations = [
                    {
                        question: 'Complete the conversation:\nA: "Good morning, how are you today?"\nB: "____________, thank you. And you?"\nA: "I\'m fine too, thanks."',
                        answer: '"Good morning, I\'m fine"'
                    },
                    {
                        question: 'Fill in the blanks in this classroom conversation:\nTeacher: "Please open your books to ______ 25."\nStudent: "Excuse me, what ______ should we do?"\nTeacher: "Do exercises 1 to 10, please."',
                        answer: 'page, exercise'
                    },
                    {
                        question: 'Create a short conversation (3-4 lines) between a teacher and student about homework.',
                        answer: 'Teacher: "Did you finish your homework, John?"\nStudent: "Not yet, teacher. I had problems with question 5."\nTeacher: "OK, come to my office after class and I\'ll help you."'
                    }
                ];
                return conversations.slice(0, count);
            },
            
            generateEnglishVocabularyExercises(prompt, count) {
                const engineeringWords = [
                    { word: 'engineer', meaning: '‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£' },
                    { word: 'design', meaning: '‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö' },
                    { word: 'construction', meaning: '‡∏Å‡∏≤‡∏£‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á' },
                    { word: 'mechanical', meaning: '‡∏ó‡∏≤‡∏á‡∏Å‡∏•‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå' },
                    { word: 'electrical', meaning: '‡∏ó‡∏≤‡∏á‡πÑ‡∏ü‡∏ü‡πâ‡∏≤' },
                    { word: 'structure', meaning: '‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á' },
                    { word: 'material', meaning: '‡∏ß‡∏±‡∏™‡∏î‡∏∏' },
                    { word: 'project', meaning: '‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£' },
                    { word: 'analysis', meaning: '‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå' },
                    { word: 'system', meaning: '‡∏£‡∏∞‡∏ö‡∏ö' }
                ];
                
                const exercises = [];
                for (let i = 0; i < count && i < engineeringWords.length; i++) {
                    const word = engineeringWords[i];
                    exercises.push({
                        question: `Match the English word with its Thai meaning:\n"${word.word}" = ?`,
                        answer: `"${word.word}" = ${word.meaning}`
                    });
                }
                return exercises;
            },
            
            generateEnglishFillBlankExercises(prompt, count) {
                const exercises = [
                    {
                        question: 'Fill in the blank with the correct verb: She usually ______ (go) to school by bus.',
                        answer: 'goes'
                    },
                    {
                        question: 'Complete the sentence: If I ______ (have) more time, I would travel more.',
                        answer: 'had'
                    },
                    {
                        question: 'Choose the correct word: The ______ (weather/whether) is very hot today.',
                        answer: 'weather'
                    },
                    {
                        question: 'Fill in with appropriate preposition: I\'m interested ______ learning English.',
                        answer: 'in'
                    },
                    {
                        question: 'Complete with correct article: He is ______ honest person.',
                        answer: 'an'
                    }
                ];
                return exercises.slice(0, count);
            },
            
            generateEnglishGeneralExercises(prompt, count) {
                const exercises = [
                    {
                        question: 'Change to negative: "She can speak Chinese very well."',
                        answer: 'She cannot speak Chinese very well. / She can\'t speak Chinese very well.'
                    },
                    {
                        question: 'Make a question from: "They are watching TV in the living room."',
                        answer: 'Are they watching TV in the living room?'
                    },
                    {
                        question: 'What is the past tense of "go"?',
                        answer: 'went'
                    },
                    {
                        question: 'Make this sentence plural: "The child is playing with a toy."',
                        answer: 'The children are playing with toys.'
                    },
                    {
                        question: 'Correct the sentence: "He don\'t like coffee."',
                        answer: 'He doesn\'t like coffee.'
                    }
                ];
                return exercises.slice(0, count);
            },
            
            // Chinese exercise generators
            generateChineseConversationExercises(prompt, count) {
                const exercises = [
                    {
                        question: 'ÂÆåÊàêÂØπËØù:\nA: "‰Ω†Â•ΩÂêó?"\nB: "____________ÔºåË∞¢Ë∞¢„ÄÇ‰Ω†Âë¢?"\nA: "Êàë‰πüÂæàÂ•ΩÔºåË∞¢Ë∞¢„ÄÇ"',
                        answer: 'ÊàëÂæàÂ•Ω'
                    },
                    {
                        question: 'ËØæÂ†ÇÂØπËØùÂ°´Á©∫:\nËÄÅÂ∏à: "ËØ∑ÊâìÂºÄ‰π¶Âà∞Á¨¨______È°µ„ÄÇ"\nÂ≠¶Áîü: "ÂØπ‰∏çËµ∑ÔºåÊàë‰ª¨Â∫îËØ•ÂÅöÁ¨¨______È¢ò?"\nËÄÅÂ∏à: "ËØ∑ÂÅöÁ¨¨1Âà∞Á¨¨10È¢ò„ÄÇ"',
                        answer: '25, Âá†'
                    },
                    {
                        question: 'ÂàõÂª∫‰∏Ä‰∏™ÂÖ≥‰∫éÂÆ∂Â∫≠‰Ωú‰∏öÁöÑÁÆÄÁü≠ÂØπËØùÔºà3-4Ë°åÔºâÂú®ËÄÅÂ∏àÂíåÂ≠¶Áîü‰πãÈó¥„ÄÇ',
                        answer: 'ËÄÅÂ∏à: "Â∞èÊòéÔºå‰Ω†ÁöÑ‰Ωú‰∏öÂÅöÂÆå‰∫ÜÂêó?"\nÂ∞èÊòé: "ËøòÊ≤°ÂÅöÂÆåÔºåËÄÅÂ∏à„ÄÇÁ¨¨‰∫îÈ¢òÊàëÊúâÈóÆÈ¢ò„ÄÇ"\nËÄÅÂ∏à: "Â•ΩÁöÑÔºå‰∏ãËØæÂêéÂà∞ÊàëÁöÑÂäûÂÖ¨ÂÆ§ÔºåÊàëÂ∏Æ‰Ω†„ÄÇ"'
                    }
                ];
                return exercises.slice(0, count);
            },
            
            generateChineseVocabularyExercises(prompt, count) {
                const engineeringWords = [
                    { chinese: 'Â∑•Á®ãÂ∏à', pinyin: 'g≈çngch√©ngshƒ´', meaning: '‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£' },
                    { chinese: 'ËÆæËÆ°', pinyin: 'sh√®j√¨', meaning: '‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö' },
                    { chinese: 'Âª∫Á≠ë', pinyin: 'ji√†nzh√π', meaning: '‡∏Å‡∏≤‡∏£‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á' },
                    { chinese: 'Êú∫Ê¢∞', pinyin: 'jƒ´xi√®', meaning: '‡∏ó‡∏≤‡∏á‡∏Å‡∏•‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå' },
                    { chinese: 'ÁîµÊ∞î', pinyin: 'di√†nq√¨', meaning: '‡∏ó‡∏≤‡∏á‡πÑ‡∏ü‡∏ü‡πâ‡∏≤' },
                    { chinese: 'ÁªìÊûÑ', pinyin: 'ji√©g√≤u', meaning: '‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á' },
                    { chinese: 'ÊùêÊñô', pinyin: 'c√°ili√†o', meaning: '‡∏ß‡∏±‡∏™‡∏î‡∏∏' },
                    { chinese: 'È°πÁõÆ', pinyin: 'xi√†ngm√π', meaning: '‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£' },
                    { chinese: 'ÂàÜÊûê', pinyin: 'fƒìnxƒ´', meaning: '‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå' },
                    { chinese: 'Á≥ªÁªü', pinyin: 'x√¨t«íng', meaning: '‡∏£‡∏∞‡∏ö‡∏ö' }
                ];
                
                const exercises = [];
                for (let i = 0; i < count && i < engineeringWords.length; i++) {
                    const word = engineeringWords[i];
                    exercises.push({
                        question: `ÂåπÈÖç‰∏≠ÊñáËØçÊ±á‰∏éÂÖ∂ÊÑèÊÄù:\n"${word.chinese}" (${word.pinyin}) = ?`,
                        answer: `"${word.chinese}" = ${word.meaning}`
                    });
                }
                return exercises;
            },
            
            generateChineseSentenceExercises(prompt, count) {
                const exercises = [
                    {
                        question: 'Áî®"ÂñúÊ¨¢"ÈÄ†‰∏Ä‰∏™Âè•Â≠ê„ÄÇ',
                        answer: 'ÊàëÂñúÊ¨¢Â≠¶‰π†‰∏≠Êñá„ÄÇ (‡∏â‡∏±‡∏ô‡∏ä‡∏≠‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡∏à‡∏µ‡∏ô)'
                    },
                    {
                        question: 'Áî®"Âú®...ÁöÑÊó∂ÂÄô"ÈÄ†‰∏Ä‰∏™Âè•Â≠ê„ÄÇ',
                        answer: 'ÊàëÂú®Â≠¶‰π†ÁöÑÊó∂ÂÄô‰∏çÂê¨Èü≥‰πê„ÄÇ (‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏â‡∏±‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ‡∏â‡∏±‡∏ô‡πÑ‡∏°‡πà‡∏ü‡∏±‡∏á‡πÄ‡∏û‡∏•‡∏á)'
                    },
                    {
                        question: 'Êää"ÊàëÂéªÂ≠¶Ê†°"ÊîπÊàêÁñëÈóÆÂè•„ÄÇ',
                        answer: '‰Ω†ÂéªÂ≠¶Ê†°ÂêóÔºü (‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏õ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏õ‡∏•‡πà‡∏≤?)'
                    },
                    {
                        question: 'Áî®"Âõ†‰∏∫...ÊâÄ‰ª•..."ÈÄ†‰∏Ä‰∏™Âè•Â≠ê„ÄÇ',
                        answer: 'Âõ†‰∏∫‰∏ãÈõ®ÔºåÊâÄ‰ª•Êàë‰ª¨‰∏çÂéªÂÖ¨Âõ≠„ÄÇ (‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏ß‡πà‡∏≤‡∏ù‡∏ô‡∏ï‡∏Å ‡∏î‡∏±‡∏á‡∏ô‡∏±‡πâ‡∏ô‡πÄ‡∏£‡∏≤‡∏à‡∏∂‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏õ‡∏™‡∏ß‡∏ô‡∏™‡∏≤‡∏ò‡∏≤‡∏£‡∏ì‡∏∞)'
                    }
                ];
                return exercises.slice(0, count);
            },
            
            generateChineseFillBlankExercises(prompt, count) {
                const exercises = [
                    {
                        question: 'Â°´Á©∫: Êàë______ (ÂêÉ) È•≠‰∫Ü„ÄÇ',
                        answer: 'ÂêÉ'
                    },
                    {
                        question: 'ÈÄâÊã©ÂêàÈÄÇÁöÑÈáèËØç: ‰∏Ä______‰π¶',
                        answer: 'Êú¨'
                    },
                    {
                        question: 'Â°´Á©∫: ‰ªñ______ (ÊòØ) ÊàëÁöÑËÄÅÂ∏à„ÄÇ',
                        answer: 'ÊòØ'
                    },
                    {
                        question: 'ÈÄâÊã©Ê≠£Á°ÆÁöÑËØç: ‰ªäÂ§©Â§©Ê∞îÂæà______ (Â•Ω/Âùè)„ÄÇ',
                        answer: 'Â•Ω'
                    }
                ];
                return exercises.slice(0, count);
            },
            
            generateChineseReorderExercises(prompt, count) {
                const exercises = [
                    {
                        question: 'ÈáçÊñ∞ÊéíÂàóËØçËØ≠ÊàêÊ≠£Á°ÆÁöÑÂè•Â≠ê: Âéª / Â≠¶Ê†° / Êàë',
                        answer: 'ÊàëÂéªÂ≠¶Ê†°„ÄÇ'
                    },
                    {
                        question: 'ÈáçÊñ∞ÊéíÂàóËØçËØ≠ÊàêÊ≠£Á°ÆÁöÑÂè•Â≠ê: ‰π¶ / ÁöÑ / Êàë / Ëøô / ÊòØ',
                        answer: 'ËøôÊòØÊàëÁöÑ‰π¶„ÄÇ'
                    },
                    {
                        question: 'ÈáçÊñ∞ÊéíÂàóËØçËØ≠ÊàêÊ≠£Á°ÆÁöÑÂè•Â≠ê: ÊòéÂ§© / ÁúãÁîµÂΩ± / Âéª / Êàë‰ª¨',
                        answer: 'Êàë‰ª¨ÊòéÂ§©ÂéªÁúãÁîµÂΩ±„ÄÇ'
                    }
                ];
                return exercises.slice(0, count);
            },
            
            generateChineseGeneralExercises(prompt, count) {
                const exercises = [
                    {
                        question: 'ÊääÂè•Â≠êÊîπÊàêÂê¶ÂÆöÂè•: "ÊàëÊòØÂ≠¶Áîü„ÄÇ"',
                        answer: 'Êàë‰∏çÊòØÂ≠¶Áîü„ÄÇ'
                    },
                    {
                        question: 'ÂÜôÂá∫Êï∞Â≠ó1-10ÁöÑ‰∏≠Êñá',
                        answer: '‰∏Ä„ÄÅ‰∫å„ÄÅ‰∏â„ÄÅÂõõ„ÄÅ‰∫î„ÄÅÂÖ≠„ÄÅ‰∏É„ÄÅÂÖ´„ÄÅ‰πù„ÄÅÂçÅ'
                    },
                    {
                        question: 'ÁøªËØëÊàê‰∏≠Êñá: "Good morning"',
                        answer: 'Êó©‰∏äÂ•Ω'
                    },
                    {
                        question: 'Áî®ÊãºÈü≥ÂÜôÂá∫: "‰Ω†Â•Ω"',
                        answer: 'n«ê h«éo'
                    }
                ];
                return exercises.slice(0, count);
            },
            
            // Thai exercise generator
            generateThaiGeneralExercises(prompt, count) {
                const exercises = [
                    {
                        question: '‡πÄ‡∏ï‡∏¥‡∏°‡∏Ñ‡∏≥‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á: ‡πÄ‡∏î‡πá‡∏Å‡∏ú‡∏π‡πâ‡∏ä‡∏≤‡∏¢‡∏Ñ‡∏ô‡∏ô‡∏±‡πâ‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà ______ ‡∏°‡∏≤‡∏Å',
                        answer: '‡∏â‡∏•‡∏≤‡∏î'
                    },
                    {
                        question: '‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Ñ‡∏≥‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á: ‡πÑ‡∏õ / ‡∏â‡∏±‡∏ô / ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô / ‡∏ó‡∏µ‡πà',
                        answer: '‡∏â‡∏±‡∏ô‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô'
                    },
                    {
                        question: '‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ‡πÄ‡∏õ‡πá‡∏ô‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò: "‡∏â‡∏±‡∏ô‡∏ä‡∏≠‡∏ö‡∏Å‡∏¥‡∏ô‡∏Ç‡πâ‡∏≤‡∏ß‡∏ú‡∏±‡∏î"',
                        answer: '‡∏â‡∏±‡∏ô‡πÑ‡∏°‡πà‡∏ä‡∏≠‡∏ö‡∏Å‡∏¥‡∏ô‡∏Ç‡πâ‡∏≤‡∏ß‡∏ú‡∏±‡∏î'
                    },
                    {
                        question: '‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏à‡∏≤‡∏Å: "‡πÄ‡∏Ç‡∏≤‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡πà‡∏≤‡∏ô‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠"',
                        answer: '‡πÄ‡∏Ç‡∏≤‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡πà‡∏≤‡∏ô‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏≠‡∏¢‡∏π‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏õ‡∏•‡πà‡∏≤?'
                    },
                    {
                        question: '‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏£‡∏≤‡∏ä‡∏≤‡∏®‡∏±‡∏û‡∏ó‡πå‡∏Å‡∏±‡∏ö‡∏Ñ‡∏≥‡∏ß‡πà‡∏≤ "‡∏Å‡∏¥‡∏ô"',
                        answer: '‡πÄ‡∏™‡∏ß‡∏¢'
                    }
                ];
                return exercises.slice(0, count);
            },
            
            // Use AI generated exercise
            useAIExercise() {
                // Use the first exercise from generated ones
                if (this.lastGeneratedExercises && this.lastGeneratedExercises.length > 0) {
                    const firstExercise = this.lastGeneratedExercises[0];
                    
                    document.getElementById('exercise-question').value = firstExercise.question;
                    document.getElementById('exercise-answer').value = firstExercise.answer;
                    
                    // Apply Chinese font if needed
                    if (this.currentLanguage === 'chinese') {
                        document.getElementById('exercise-question').classList.add('chinese-font');
                        document.getElementById('exercise-answer').classList.add('chinese-font');
                    }
                    
                    // Hide preview
                    document.getElementById('ai-exercise-preview').classList.remove('show');
                    document.getElementById('ai-prompt').value = '';
                    
                    this.showAlert('‡∏ô‡∏≥‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î‡∏à‡∏≤‡∏Å AI ‡πÑ‡∏õ‡πÉ‡∏ä‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ (‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡πÅ‡∏£‡∏Å‡∏à‡∏≤‡∏Å‡∏´‡∏•‡∏≤‡∏¢‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á)', 'success');
                } else {
                    this.showAlert('‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ß‡πâ', 'warning');
                }
            },
            
            // ============================================
            // COURSE MANAGEMENT FUNCTIONS
            // ============================================
            
            // Create new course
            saveCourse() {
                const name = document.getElementById('course-name').value;
                const classType = document.getElementById('course-type').value;
                const description = document.getElementById('course-description').value;
                const maxStudents = parseInt(document.getElementById('max-students').value);
                const jitsiRoom = document.getElementById('jitsi-room').value;
                const imageFile = document.getElementById('course-image').files[0];
                
                if (!name || !classType || !description || !jitsiRoom) {
                    this.showAlert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô', 'warning');
                    return;
                }
                
                // Generate course ID
                const courseId = 'C' + (this.courses.length + 1).toString().padStart(3, '0');
                
                // Handle image upload
                let imageData = '';
                if (imageFile) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        imageData = e.target.result;
                        this.finalizeSaveCourse(courseId, name, classType, description, maxStudents, jitsiRoom, imageData);
                    };
                    reader.readAsDataURL(imageFile);
                } else {
                    this.finalizeSaveCourse(courseId, name, classType, description, maxStudents, jitsiRoom, imageData);
                }
            },
            
            // Finalize course saving
            finalizeSaveCourse(courseId, name, classType, description, maxStudents, jitsiRoom, imageData) {
                const newCourse = {
                    id: courseId,
                    name: name,
                    teacherId: this.user.id,
                    teacherName: this.user.name,
                    description: description,
                    image: imageData,
                    jitsiRoom: jitsiRoom,
                    maxStudents: maxStudents,
                    currentStudents: 0,
                    classType: classType,
                    status: 'active',
                    securityCode: this.generateSecurityCode(),
                    createdDate: new Date().toISOString(),
                    lessons: [],
                    exercises: []
                };
                
                this.courses.push(newCourse);
                this.saveToStorage();
                this.hideCourseModal();
                this.showDashboard();
                this.showAlert(`‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≠‡∏£‡πå‡∏™ "${name}" ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!`, 'success');
            },
            
            // Preview course image
            previewCourseImage(input) {
                const preview = document.getElementById('course-image-preview');
                if (input.files && input.files[0]) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        preview.src = e.target.result;
                        preview.classList.add('show');
                    };
                    reader.readAsDataURL(input.files[0]);
                }
            },
            
            // Enroll student in course
            enrollInCourse(courseId) {
                const course = this.courses.find(c => c.id === courseId);
                if (!course) return false;
                
                if (course.currentStudents >= course.maxStudents) {
                    this.showAlert('‡∏Ñ‡∏≠‡∏£‡πå‡∏™‡∏ô‡∏µ‡πâ‡πÄ‡∏ï‡πá‡∏°‡πÅ‡∏•‡πâ‡∏ß', 'warning');
                    return false;
                }
                
                course.currentStudents++;
                this.saveToStorage();
                return true;
            },
            
            // Mark course as completed
            markCourseCompleted(courseId) {
                const course = this.courses.find(c => c.id === courseId);
                if (!course) return;
                
                // Record result
                const result = {
                    studentId: this.user.id,
                    studentName: this.user.name,
                    courseId: course.id,
                    courseName: course.name,
                    exerciseCount: course.exercises.length,
                    score: Object.keys(this.quizState.completed).filter(key => 
                        key.startsWith(courseId)
                    ).length,
                    date: new Date().toISOString()
                };
                
                this.results.push(result);
                this.saveToStorage();
                
                this.showAlert('‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏à‡∏ö‡∏Ñ‡∏≠‡∏£‡πå‡∏™‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', 'success');
            },
            
            // ============================================
            // LESSON MANAGEMENT FUNCTIONS
            // ============================================
            
            // Handle lesson file upload
            handleLessonFileUpload(file) {
                if (!file) return;
                
                const preview = document.getElementById('lesson-file-preview');
                const fileInfo = document.getElementById('lesson-file-info');
                
                // Show preview
                preview.classList.remove('hidden');
                fileInfo.innerHTML = `
                    <p><strong>‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå:</strong> ${file.name}</p>
                    <p><strong>‡∏Ç‡∏ô‡∏≤‡∏î:</strong> ${(file.size / 1024).toFixed(2)} KB</p>
                    <p><strong>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó:</strong> ${file.type || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}</p>
                `;
                
                // Store file for saving
                this.lessonFile = file;
            },
            
            // Save lesson (create or update)
            saveLesson() {
                const lessonId = document.getElementById('lesson-id').value;
                const courseId = document.getElementById('lesson-course-id').value;
                const title = document.getElementById('lesson-title').value;
                const content = document.getElementById('lesson-content').value;
                
                if (!title || !content) {
                    this.showAlert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô', 'warning');
                    return;
                }
                
                const course = this.courses.find(c => c.id === courseId);
                if (!course) return;
                
                // Handle file upload
                let fileData = null;
                let fileName = '';
                let fileType = '';
                
                if (this.lessonFile) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        fileData = e.target.result;
                        fileName = this.lessonFile.name;
                        fileType = this.lessonFile.type;
                        this.finalizeSaveLesson(lessonId, courseId, title, content, fileData, fileName, fileType);
                    };
                    reader.readAsDataURL(this.lessonFile);
                } else {
                    this.finalizeSaveLesson(lessonId, courseId, title, content, fileData, fileName, fileType);
                }
            },
            
            // Finalize lesson saving
            finalizeSaveLesson(lessonId, courseId, title, content, fileData, fileName, fileType) {
                const course = this.courses.find(c => c.id === courseId);
                
                if (lessonId) {
                    // Update existing lesson
                    const lessonIndex = course.lessons.findIndex(l => l.id === lessonId);
                    if (lessonIndex !== -1) {
                        course.lessons[lessonIndex] = {
                            ...course.lessons[lessonIndex],
                            title: title,
                            content: content,
                            file: fileData,
                            fileName: fileName,
                            fileType: fileType,
                            updatedAt: new Date().toISOString()
                        };
                    }
                } else {
                    // Create new lesson
                    const newLesson = {
                        id: 'L' + (course.lessons.length + 1).toString().padStart(3, '0'),
                        title: title,
                        content: content,
                        file: fileData,
                        fileName: fileName,
                        fileType: fileType,
                        createdAt: new Date().toISOString()
                    };
                    
                    course.lessons.push(newLesson);
                }
                
                this.saveToStorage();
                this.hideLessonModal();
                this.showManageLessons(courseId);
                this.showAlert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', 'success');
                
                // Clear file reference
                this.lessonFile = null;
            },
            
            // Delete lesson
            deleteLesson(courseId, lessonId) {
                if (!confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ô‡∏µ‡πâ?')) return;
                
                const course = this.courses.find(c => c.id === courseId);
                if (!course) return;
                
                course.lessons = course.lessons.filter(l => l.id !== lessonId);
                this.saveToStorage();
                this.showManageLessons(courseId);
                this.showAlert('‡∏•‡∏ö‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', 'success');
            },
            
            // ============================================
            // EXERCISE MANAGEMENT FUNCTIONS
            // ============================================
            
            // Handle exercise image upload
            handleExerciseImageUpload(file) {
                if (!file) return;
                
                const preview = document.getElementById('exercise-image-preview');
                const previewImg = document.getElementById('exercise-preview-img');
                const fileInfo = document.getElementById('exercise-image-info');
                
                // Show preview
                preview.classList.remove('hidden');
                
                // Create preview image
                const reader = new FileReader();
                reader.onload = (e) => {
                    previewImg.src = e.target.result;
                    fileInfo.innerHTML = `
                        <p><strong>‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå:</strong> ${file.name}</p>
                        <p><strong>‡∏Ç‡∏ô‡∏≤‡∏î:</strong> ${(file.size / 1024).toFixed(2)} KB</p>
                        <button type="button" class="btn btn-primary btn-sm mt-10" onclick="AppState.previewExerciseImage('${e.target.result}')">
                            <i class="fas fa-expand"></i> ‡∏î‡∏π‡∏†‡∏≤‡∏û‡πÄ‡∏ï‡πá‡∏°
                        </button>
                    `;
                };
                reader.readAsDataURL(file);
                
                // Store file for saving
                this.exerciseImageFile = file;
            },
            
            // Preview exercise image
            previewExerciseImage(imageSrc) {
                const previewImg = document.getElementById('preview-image');
                previewImg.src = imageSrc;
                this.showModal('preview-image-modal');
            },
            
            // Save exercise (create or update)
            saveExercise() {
                const exerciseId = document.getElementById('exercise-id').value;
                const courseId = document.getElementById('exercise-course-id').value;
                const lessonId = document.getElementById('exercise-lesson').value;
                const question = document.getElementById('exercise-question').value;
                const answer = document.getElementById('exercise-answer').value;
                const difficulty = document.getElementById('exercise-difficulty').value;
                
                if (!lessonId || !question || !answer) {
                    this.showAlert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô', 'warning');
                    return;
                }
                
                // Find course containing this lesson
                const course = this.courses.find(c => c.id === courseId);
                if (!course) return;
                
                // Handle image upload
                let imageData = null;
                let imageName = '';
                
                if (this.exerciseImageFile) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        imageData = e.target.result;
                        imageName = this.exerciseImageFile.name;
                        this.finalizeSaveExercise(exerciseId, course, lessonId, question, answer, difficulty, imageData, imageName);
                    };
                    reader.readAsDataURL(this.exerciseImageFile);
                } else {
                    this.finalizeSaveExercise(exerciseId, course, lessonId, question, answer, difficulty, imageData, imageName);
                }
            },
            
            // Finalize exercise saving
            finalizeSaveExercise(exerciseId, course, lessonId, question, answer, difficulty, imageData, imageName) {
                if (exerciseId) {
                    // Update existing exercise
                    const exerciseIndex = course.exercises.findIndex(e => e.id === exerciseId);
                    if (exerciseIndex !== -1) {
                        course.exercises[exerciseIndex] = {
                            ...course.exercises[exerciseIndex],
                            lessonId: lessonId,
                            question: question,
                            answer: answer,
                            difficulty: difficulty,
                            image: imageData,
                            imageName: imageName,
                            updatedAt: new Date().toISOString()
                        };
                    }
                } else {
                    // Create new exercise
                    const newExercise = {
                        id: 'E' + (course.exercises.length + 1).toString().padStart(3, '0'),
                        lessonId: lessonId,
                        question: question,
                        image: imageData,
                        imageName: imageName,
                        answer: answer,
                        difficulty: difficulty,
                        createdAt: new Date().toISOString()
                    };
                    
                    course.exercises.push(newExercise);
                }
                
                this.saveToStorage();
                this.hideExerciseModal();
                this.showManageExercises(course.id);
                this.showAlert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', 'success');
                
                // Clear file reference
                this.exerciseImageFile = null;
            },
            
            // Delete exercise
            deleteExercise(courseId, exerciseId) {
                if (!confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î‡∏ô‡∏µ‡πâ?')) return;
                
                const course = this.courses.find(c => c.id === courseId);
                if (!course) return;
                
                course.exercises = course.exercises.filter(e => e.id !== exerciseId);
                this.saveToStorage();
                this.showManageExercises(courseId);
                this.showAlert('‡∏•‡∏ö‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', 'success');
            },
            
            // ============================================
            // QUIZ SYSTEM FUNCTIONS - FIXED
            // ============================================
            
            // Submit quiz answer - ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏ï‡∏≤‡∏°‡∏Ç‡πâ‡∏≠‡∏Å‡∏≥‡∏´‡∏ô‡∏î
            submitQuizAnswer(courseId, exerciseId, answer) {
                const exercise = this.getExerciseById(courseId, exerciseId);
                if (!exercise) return false;
                
                const isCorrect = this.checkAnswer(answer, exercise.answer);
                const key = `${courseId}_${exerciseId}`;
                
                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
                if (!this.quizState.attempts[key]) {
                    this.quizState.attempts[key] = 0;
                }
                
                // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏ï‡∏≠‡∏ö
                this.quizState.attempts[key]++;
                this.quizState.answers[key] = answer;
                
                if (isCorrect) {
                    // ‡∏ï‡∏≠‡∏ö‡∏ñ‡∏π‡∏Å
                    this.quizState.completed[key] = true;
                    this.quizState.showSolution[key] = false;
                    
                    // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô
                    const attempts = this.quizState.attempts[key];
                    let score = 10; // ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏ï‡πá‡∏°
                    if (attempts > 1) score = 5; // ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏ñ‡πâ‡∏≤‡∏ï‡∏≠‡∏ö‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 1 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á
                    
                    this.quizState.scores[key] = score;
                    
                    this.showAlert('‚úÖ ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á!', 'success');
                    return true;
                } else {
                    // ‡∏ï‡∏≠‡∏ö‡∏ú‡∏¥‡∏î
                    const attempts = this.quizState.attempts[key];
                    
                    if (attempts === 1) {
                        // ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà 1 ‡∏ï‡∏≠‡∏ö‡∏ú‡∏¥‡∏î
                        this.showAlert('‚ùå ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏≠‡∏ö‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á', 'warning');
                    } else if (attempts === 2) {
                        // ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà 2 ‡∏ï‡∏≠‡∏ö‡∏ú‡∏¥‡∏î - ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏â‡∏•‡∏¢
                        this.quizState.showSolution[key] = true;
                        this.quizState.scores[key] = 0;
                        this.showAlert('‚ùå ‡∏ï‡∏≠‡∏ö‡∏ú‡∏¥‡∏î‡πÄ‡∏Å‡∏¥‡∏ô 2 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏î‡∏π‡πÄ‡∏â‡∏•‡∏¢‡πÅ‡∏•‡∏∞‡∏ï‡∏≠‡∏ö‡πÉ‡∏´‡∏°‡πà', 'danger');
                    }
                    
                    return false;
                }
            },
            
            // Check answer (case insensitive)
            checkAnswer(studentAnswer, correctAnswer) {
                if (!studentAnswer || !correctAnswer) return false;
                
                const studentClean = studentAnswer.trim().toLowerCase().replace(/\s+/g, ' ');
                const correctClean = correctAnswer.trim().toLowerCase().replace(/\s+/g, ' ');
                
                return studentClean === correctClean;
            },
            
            // Get exercise by ID
            getExerciseById(courseId, exerciseId) {
                const course = this.courses.find(c => c.id === courseId);
                if (!course) return null;
                
                return course.exercises.find(e => e.id === exerciseId);
            },
            
            // ============================================
            // UI HELPER FUNCTIONS
            // ============================================
            
            // Show modal
            showModal(modalId) {
                document.getElementById(modalId).classList.add('active');
            },
            
            // Hide modal
            hideModal(modalId) {
                document.getElementById(modalId).classList.remove('active');
            },
            
            // Show login modal
            showLoginModal() {
                this.showModal('login-modal');
            },
            
            // Hide login modal
            hideLoginModal() {
                this.hideModal('login-modal');
            },
            
            // Show course modal
            showCourseModal() {
                // Reset form
                document.getElementById('course-name').value = '';
                document.getElementById('course-type').value = '1:1';
                document.getElementById('course-description').value = '';
                document.getElementById('max-students').value = '10';
                document.getElementById('jitsi-room').value = `room-${Date.now()}`;
                document.getElementById('course-image').value = '';
                document.getElementById('course-image-preview').classList.remove('show');
                
                this.showModal('course-modal');
            },
            
            // Hide course modal
            hideCourseModal() {
                this.hideModal('course-modal');
            },
            
            // Show lesson modal
            showLessonModal(courseId, lessonId = null) {
                const course = this.courses.find(c => c.id === courseId);
                if (!course) return;
                
                // Reset file preview
                document.getElementById('lesson-file-preview').classList.add('hidden');
                this.lessonFile = null;
                
                if (lessonId) {
                    // Edit mode
                    const lesson = course.lessons.find(l => l.id === lessonId);
                    if (lesson) {
                        document.getElementById('lesson-modal-title').textContent = '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô';
                        document.getElementById('lesson-id').value = lessonId;
                        document.getElementById('lesson-title').value = lesson.title;
                        document.getElementById('lesson-content').value = lesson.content;
                        
                        if (lesson.fileName) {
                            document.getElementById('lesson-file-info').innerHTML = `
                                <p><strong>‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå:</strong> ${lesson.fileName}</p>
                                <p><strong>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó:</strong> ${lesson.fileType || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}</p>
                                <p class="text-muted">‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ‡πÅ‡∏•‡πâ‡∏ß</p>
                            `;
                            document.getElementById('lesson-file-preview').classList.remove('hidden');
                        }
                    }
                } else {
                    // Add mode
                    document.getElementById('lesson-modal-title').textContent = '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÉ‡∏´‡∏°‡πà';
                    document.getElementById('lesson-id').value = '';
                    document.getElementById('lesson-title').value = '';
                    document.getElementById('lesson-content').value = '';
                }
                
                document.getElementById('lesson-course-id').value = courseId;
                this.showModal('lesson-modal');
            },
            
            // Hide lesson modal
            hideLessonModal() {
                this.hideModal('lesson-modal');
            },
            
            // Show exercise modal
            showExerciseModal(courseId, exerciseId = null) {
                const course = this.courses.find(c => c.id === courseId);
                if (!course) return;
                
                // Reset AI preview
                document.getElementById('ai-exercise-preview').classList.remove('show');
                document.getElementById('ai-prompt').value = '';
                
                // Reset language selector
                document.querySelectorAll('.lang-btn').forEach(btn => {
                    if (btn.dataset.lang === 'english') {
                        btn.classList.add('active');
                    } else {
                        btn.classList.remove('active');
                    }
                });
                this.currentLanguage = 'english';
                this.updateAIPromptPlaceholder();
                
                // Reset image preview
                document.getElementById('exercise-image-preview').classList.add('hidden');
                this.exerciseImageFile = null;
                
                // Populate lesson options
                const lessonSelect = document.getElementById('exercise-lesson');
                lessonSelect.innerHTML = '<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</option>';
                
                course.lessons.forEach(lesson => {
                    const option = document.createElement('option');
                    option.value = lesson.id;
                    option.textContent = lesson.title;
                    lessonSelect.appendChild(option);
                });
                
                if (exerciseId) {
                    // Edit mode
                    const exercise = course.exercises.find(e => e.id === exerciseId);
                    if (exercise) {
                        document.getElementById('exercise-modal-title').textContent = '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î';
                        document.getElementById('exercise-id').value = exerciseId;
                        document.getElementById('exercise-course-id').value = courseId;
                        document.getElementById('exercise-lesson').value = exercise.lessonId;
                        document.getElementById('exercise-question').value = exercise.question;
                        document.getElementById('exercise-answer').value = exercise.answer;
                        document.getElementById('exercise-difficulty').value = exercise.difficulty || 'medium';
                        
                        if (exercise.image) {
                            const previewImg = document.getElementById('exercise-preview-img');
                            previewImg.src = exercise.image;
                            document.getElementById('exercise-image-info').innerHTML = `
                                <p><strong>‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå:</strong> ${exercise.imageName}</p>
                                <p class="text-muted">‡∏†‡∏≤‡∏û‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ‡πÅ‡∏•‡πâ‡∏ß</p>
                                <button type="button" class="btn btn-primary btn-sm mt-10" onclick="AppState.previewExerciseImage('${exercise.image}')">
                                    <i class="fas fa-expand"></i> ‡∏î‡∏π‡∏†‡∏≤‡∏û‡πÄ‡∏ï‡πá‡∏°
                                </button>
                            `;
                            document.getElementById('exercise-image-preview').classList.remove('hidden');
                        }
                    }
                } else {
                    // Add mode
                    document.getElementById('exercise-modal-title').textContent = '‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î‡πÉ‡∏´‡∏°‡πà';
                    document.getElementById('exercise-id').value = '';
                    document.getElementById('exercise-course-id').value = courseId;
                    document.getElementById('exercise-lesson').value = course.lessons.length > 0 ? course.lessons[0].id : '';
                    document.getElementById('exercise-question').value = '';
                    document.getElementById('exercise-answer').value = '';
                    document.getElementById('exercise-difficulty').value = 'medium';
                }
                
                this.showModal('exercise-modal');
            },
            
            // Hide exercise modal
            hideExerciseModal() {
                this.hideModal('exercise-modal');
            },
            
            // Show upload modal
            showUploadModal() {
                document.getElementById('upload-preview').classList.add('hidden');
                document.getElementById('file-upload-info').classList.add('hidden');
                document.getElementById('confirm-upload').classList.add('hidden');
                document.getElementById('csv-file').value = '';
                
                // Show students list by default
                this.showStudentsList();
                
                this.showModal('upload-modal');
            },
            
            // Hide upload modal
            hideUploadModal() {
                this.hideModal('upload-modal');
            },
            
            // Switch login tab
            switchLoginTab(tabId) {
                // Update tab buttons
                document.querySelectorAll('[data-tab]').forEach(tab => {
                    tab.classList.toggle('active', tab.dataset.tab === tabId);
                });
                
                // Update tab contents
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.toggle('active', content.id === tabId);
                });
            },
            
            // Switch upload tab
            switchUploadTab(tabId) {
                // Update tab buttons in upload modal
                document.querySelectorAll('#upload-modal [data-tab]').forEach(tab => {
                    tab.classList.toggle('active', tab.dataset.tab === tabId);
                });
                
                // Update tab contents
                document.querySelectorAll('#upload-modal .tab-content').forEach(content => {
                    content.classList.toggle('active', content.id === tabId);
                });
                
                // Load appropriate content
                switch (tabId) {
                    case 'view-students':
                        this.showStudentsList();
                        break;
                    case 'view-teachers':
                        this.showTeachersList();
                        break;
                    case 'view-results':
                        this.showResultsList();
                        break;
                }
            },
            
            // Toggle sidebar
            toggleSidebar() {
                const sidebar = document.getElementById('sidebar');
                const toggleIcon = document.getElementById('toggle-icon');
                
                sidebar.classList.toggle('collapsed');
                toggleIcon.classList.toggle('fa-chevron-left');
                toggleIcon.classList.toggle('fa-chevron-right');
            },
            
            // Show alert message
            showAlert(message, type = 'info') {
                // Remove existing alerts
                const existingAlert = document.querySelector('.alert');
                if (existingAlert) {
                    existingAlert.remove();
                }
                
                // Create alert element
                const alert = document.createElement('div');
                alert.className = `alert alert-${type}`;
                alert.innerHTML = `
                    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'warning' ? 'exclamation-triangle' : type === 'danger' ? 'times-circle' : 'info-circle'}"></i>
                    ${message}
                `;
                
                // Add to page
                const content = document.getElementById('page-content');
                if (content && content.firstChild) {
                    content.insertBefore(alert, content.firstChild);
                } else if (content) {
                    content.appendChild(alert);
                }
                
                // Auto remove after 5 seconds
                setTimeout(() => {
                    if (alert.parentNode) {
                        alert.remove();
                    }
                }, 5000);
            },
            
            // Show dashboard based on user role
            showDashboard() {
                this.updateUIForUser();
                
                if (this.user.role === 'teacher') {
                    this.showTeacherDashboard();
                } else if (this.user.role === 'student') {
                    this.showStudentDashboard();
                } else {
                    this.showHomePage();
                }
            },
            
            // Update UI elements based on user
            updateUIForUser() {
                const userInfo = document.getElementById('user-info');
                const userName = document.getElementById('user-name');
                const logoutBtn = document.getElementById('logout-btn');
                const userProfile = document.getElementById('user-profile');
                const sidebarUserName = document.getElementById('sidebar-user-name');
                const sidebarUserRole = document.getElementById('sidebar-user-role');
                
                if (this.user.role) {
                    // User is logged in
                    userName.textContent = this.user.name;
                    sidebarUserName.textContent = this.user.name;
                    sidebarUserRole.textContent = this.user.role === 'teacher' ? '‡∏Ñ‡∏£‡∏π‡∏ú‡∏π‡πâ‡∏™‡∏≠‡∏ô' : '‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô';
                    
                    userInfo.classList.remove('hidden');
                    logoutBtn.classList.remove('hidden');
                    userProfile.classList.remove('hidden');
                    
                    this.updateSidebarMenu();
                } else {
                    // User is not logged in
                    userInfo.classList.add('hidden');
                    logoutBtn.classList.add('hidden');
                    userProfile.classList.add('hidden');
                }
            },
            
            // Update sidebar menu based on user role
            updateSidebarMenu() {
                const menu = document.getElementById('sidebar-menu');
                menu.innerHTML = '';
                
                if (this.user.role === 'teacher') {
                    // Teacher menu
                    const menuItems = [
                        { id: 'dashboard', icon: 'fas fa-tachometer-alt', text: 'Dashboard', page: 'teacher_dashboard' },
                        { id: 'courses', icon: 'fas fa-book', text: '‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≠‡∏£‡πå‡∏™', page: 'manage_courses' },
                        { id: 'lessons', icon: 'fas fa-file-alt', text: '‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô', page: 'manage_lessons' },
                        { id: 'exercises', icon: 'fas fa-edit', text: '‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î', page: 'manage_exercises' },
                        { id: 'documents', icon: 'fas fa-file-upload', text: '‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£', page: 'manage_documents' },
                        { id: 'certificates', icon: 'fas fa-certificate', text: '‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á', page: 'manage_certificates' },
                        { id: 'upload', icon: 'fas fa-upload', text: '‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', page: 'upload_data' },
                        { id: 'live', icon: 'fas fa-video', text: '‡∏™‡∏≠‡∏ô‡∏™‡∏î', page: 'live_teaching' }
                    ];
                    
                    menuItems.forEach(item => {
                        const li = document.createElement('li');
                        li.innerHTML = `
                            <a href="#" class="menu-item ${this.currentPage === item.page ? 'active' : ''}" data-page="${item.page}">
                                <i class="${item.icon}"></i>
                                <span class="menu-text">${item.text}</span>
                            </a>
                        `;
                        menu.appendChild(li);
                    });
                } else if (this.user.role === 'student') {
                    // Student menu
                    const menuItems = [
                        { id: 'home', icon: 'fas fa-home', text: '‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å', page: 'student_home' },
                        { id: 'courses', icon: 'fas fa-book', text: '‡∏Ñ‡∏≠‡∏£‡πå‡∏™‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô', page: 'student_courses' }
                    ];
                    
                    // Add live class option if attended
                    if (this.user.hasAttendedLive) {
                        menuItems.push(
                            { id: 'live', icon: 'fas fa-video', text: '‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡∏î', page: 'live_student' },
                            { id: 'exercises', icon: 'fas fa-edit', text: '‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î', page: 'student_exercises' },
                            { id: 'documents', icon: 'fas fa-download', text: '‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î', page: 'student_documents' }
                        );
                    }
                    
                    menuItems.forEach(item => {
                        const li = document.createElement('li');
                        li.innerHTML = `
                            <a href="#" class="menu-item ${this.currentPage === item.page ? 'active' : ''}" data-page="${item.page}">
                                <i class="${item.icon}"></i>
                                <span class="menu-text">${item.text}</span>
                            </a>
                        `;
                        menu.appendChild(li);
                    });
                }
                
                // Add event listeners to menu items
                menu.querySelectorAll('.menu-item').forEach(item => {
                    item.addEventListener('click', (e) => {
                        e.preventDefault();
                        const page = e.currentTarget.dataset.page;
                        this.navigateTo(page);
                    });
                });
            },
            
            // Navigate to page
            navigateTo(page) {
                this.currentPage = page;
                
                switch (page) {
                    case 'teacher_dashboard':
                        this.showTeacherDashboard();
                        break;
                    case 'manage_courses':
                        this.showManageCourses();
                        break;
                    case 'manage_lessons':
                        this.showManageLessons();
                        break;
                    case 'manage_exercises':
                        this.showManageExercises();
                        break;
                    case 'manage_documents':
                        this.showManageDocuments();
                        break;
                    case 'manage_certificates':
                        this.showManageCertificates();
                        break;
                    case 'upload_data':
                        this.showUploadData();
                        break;
                    case 'live_teaching':
                        this.showLiveTeaching();
                        break;
                    case 'student_home':
                        this.showStudentHome();
                        break;
                    case 'student_courses':
                        this.showStudentCourses();
                        break;
                    case 'live_student':
                        this.showLiveStudent();
                        break;
                    case 'student_exercises':
                        this.showStudentExercises();
                        break;
                    case 'student_documents':
                        this.showStudentDocuments();
                        break;
                    default:
                        this.showHomePage();
                }
                
                // Update active menu item
                this.updateSidebarMenu();
            },
            
            // ============================================
            // PAGE RENDERING FUNCTIONS
            // ============================================
            
            // Show home page (for guests)
            showHomePage() {
                const content = document.getElementById('page-content');
                content.innerHTML = `
                    <div class="text-center">
                        <h1 class="page-title">‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà ZL TA-Learning</h1>
                        <p class="mb-30">‡∏£‡∏∞‡∏ö‡∏ö‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢‡∏™‡∏≠‡∏ô-‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå (100% Live Class)</p>
                        
                        <div class="card">
                            <h3 class="card-title">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</h3>
                            <p>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</p>
                            <button id="show-login" class="btn btn-primary btn-lg mt-20">
                                <i class="fas fa-sign-in-alt"></i> ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
                            </button>
                        </div>
                    </div>
                `;
                
                document.getElementById('show-login').addEventListener('click', () => {
                    this.showLoginModal();
                });
            },
            
            // Show teacher dashboard
            showTeacherDashboard() {
                const teacherCourses = this.courses.filter(c => c.teacherId === this.user.id);
                
                const content = document.getElementById('page-content');
                content.innerHTML = `
                    <h1 class="page-title">Dashboard ‡∏Ñ‡∏£‡∏π‡∏ú‡∏π‡πâ‡∏™‡∏≠‡∏ô</h1>
                    
                    <div class="stats-grid">
                        <div class="stat-card">
                            <i class="fas fa-book fa-2x mb-10"></i>
                            <h3>${teacherCourses.length}</h3>
                            <p>‡∏Ñ‡∏≠‡∏£‡πå‡∏™‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</p>
                        </div>
                        <div class="stat-card">
                            <i class="fas fa-users fa-2x mb-10"></i>
                            <h3>${teacherCourses.reduce((sum, course) => sum + course.currentStudents, 0)}</h3>
                            <p>‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</p>
                        </div>
                        <div class="stat-card">
                            <i class="fas fa-file-alt fa-2x mb-10"></i>
                            <h3>${teacherCourses.reduce((sum, course) => sum + course.lessons.length, 0)}</h3>
                            <p>‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                        </div>
                        <div class="stat-card">
                            <i class="fas fa-edit fa-2x mb-10"></i>
                            <h3>${teacherCourses.reduce((sum, course) => sum + course.exercises.length, 0)}</h3>
                            <p>‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="d-flex justify-between align-center mb-20">
                            <h3 class="card-title mb-0">‡∏Ñ‡∏≠‡∏£‡πå‡∏™‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</h3>
                            <button id="create-course" class="btn btn-primary">
                                <i class="fas fa-plus"></i> ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≠‡∏£‡πå‡∏™‡πÉ‡∏´‡∏°‡πà
                            </button>
                        </div>
                        
                        ${teacherCourses.length > 0 ? `
                            <div class="course-grid">
                                ${teacherCourses.slice(0, 3).map(course => `
                                    <div class="course-card">
                                        ${course.image ? `<img src="${course.image}" class="course-image" alt="${course.name}">` : ''}
                                        <h4>${course.name}</h4>
                                        <p>${course.description.substring(0, 100)}${course.description.length > 100 ? '...' : ''}</p>
                                        <div class="d-flex gap-10 mt-20">
                                            <button class="btn btn-primary w-100" data-action="manage" data-course="${course.id}">
                                                ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£
                                            </button>
                                            <button class="btn btn-success w-100" data-action="live" data-course="${course.id}">
                                                ‡∏™‡∏≠‡∏ô‡∏™‡∏î
                                            </button>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        ` : `
                            <div class="empty-state">
                                <i class="fas fa-book"></i>
                                <h4>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≠‡∏£‡πå‡∏™‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h4>
                                <p>‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≠‡∏£‡πå‡∏™‡πÅ‡∏£‡∏Å‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>
                            </div>
                        `}
                    </div>
                    
                    <div class="card">
                        <h3 class="card-title">‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏î‡πà‡∏ß‡∏ô</h3>
                        <div class="d-flex gap-10 flex-wrap">
                            <button id="upload-data" class="btn btn-primary">
                                <i class="fas fa-upload"></i> ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                            </button>
                            <button id="manage-all-courses" class="btn btn-secondary">
                                <i class="fas fa-cog"></i> ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≠‡∏£‡πå‡∏™‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                            </button>
                            <button id="view-students" class="btn btn-success">
                                <i class="fas fa-users"></i> ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
                            </button>
                        </div>
                    </div>
                `;
                
                // Add event listeners
                document.getElementById('create-course').addEventListener('click', () => {
                    this.showCourseModal();
                });
                
                document.getElementById('upload-data').addEventListener('click', () => {
                    this.showUploadModal();
                });
                
                document.getElementById('manage-all-courses').addEventListener('click', () => {
                    this.showManageCourses();
                });
                
                document.getElementById('view-students').addEventListener('click', () => {
                    this.showUploadModal();
                    // Switch to view students tab
                    setTimeout(() => {
                        document.querySelector('#upload-modal [data-tab="view-students"]').click();
                    }, 100);
                });
                
                document.querySelectorAll('[data-action]').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const action = e.currentTarget.dataset.action;
                        const courseId = e.currentTarget.dataset.course;
                        
                        if (action === 'manage') {
                            this.currentCourse = this.courses.find(c => c.id === courseId);
                            this.showManageLessons(courseId);
                        } else if (action === 'live') {
                            const course = this.courses.find(c => c.id === courseId);
                            this.currentCourse = course;
                            this.showLiveTeaching();
                        }
                    });
                });
            },
            
            // Show manage courses page
            showManageCourses() {
                const teacherCourses = this.courses.filter(c => c.teacherId === this.user.id);
                
                const content = document.getElementById('page-content');
                content.innerHTML = `
                    <div class="d-flex justify-between align-center mb-30">
                        <h1 class="page-title mb-0">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≠‡∏£‡πå‡∏™‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h1>
                        <button id="create-course" class="btn btn-primary">
                            <i class="fas fa-plus"></i> ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≠‡∏£‡πå‡∏™‡πÉ‡∏´‡∏°‡πà
                        </button>
                    </div>
                    
                    ${teacherCourses.length > 0 ? `
                        <div class="course-grid">
                            ${teacherCourses.map(course => `
                                <div class="course-card">
                                    ${course.image ? `<img src="${course.image}" class="course-image" alt="${course.name}">` : ''}
                                    <h4>${course.name}</h4>
                                    <p><strong>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó:</strong> ${course.classType}</p>
                                    <p><strong>‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô:</strong> ${course.currentStudents}/${course.maxStudents} ‡∏Ñ‡∏ô</p>
                                    <p>${course.description.substring(0, 150)}${course.description.length > 150 ? '...' : ''}</p>
                                    
                                    <div class="d-flex gap-10 mt-20">
                                        <button class="btn btn-primary btn-sm" data-action="lessons" data-course="${course.id}">
                                            <i class="fas fa-file-alt"></i> ‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
                                        </button>
                                        <button class="btn btn-success btn-sm" data-action="exercises" data-course="${course.id}">
                                            <i class="fas fa-edit"></i> ‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î
                                        </button>
                                        <button class="btn btn-warning btn-sm" data-action="documents" data-course="${course.id}">
                                            <i class="fas fa-file-upload"></i> ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£
                                        </button>
                                        <button class="btn btn-info btn-sm" data-action="live" data-course="${course.id}">
                                            <i class="fas fa-video"></i> ‡∏™‡∏≠‡∏ô‡∏™‡∏î
                                        </button>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    ` : `
                        <div class="card">
                            <div class="empty-state">
                                <i class="fas fa-book"></i>
                                <h4>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≠‡∏£‡πå‡∏™‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h4>
                                <p>‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≠‡∏£‡πå‡∏™‡πÅ‡∏£‡∏Å‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>
                                <button id="create-first-course" class="btn btn-primary mt-20">
                                    <i class="fas fa-plus"></i> ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≠‡∏£‡πå‡∏™‡πÅ‡∏£‡∏Å
                                </button>
                            </div>
                        </div>
                    `}
                `;
                
                // Add event listeners
                document.getElementById('create-course')?.addEventListener('click', () => {
                    this.showCourseModal();
                });
                
                document.getElementById('create-first-course')?.addEventListener('click', () => {
                    this.showCourseModal();
                });
                
                document.querySelectorAll('[data-action]').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const action = e.currentTarget.dataset.action;
                        const courseId = e.currentTarget.dataset.course;
                        const course = this.courses.find(c => c.id === courseId);
                        
                        if (!course) return;
                        
                        this.currentCourse = course;
                        
                        switch (action) {
                            case 'lessons':
                                this.showManageLessons(courseId);
                                break;
                            case 'exercises':
                                this.showManageExercises(courseId);
                                break;
                            case 'documents':
                                this.showManageDocuments();
                                break;
                            case 'live':
                                this.showLiveTeaching();
                                break;
                        }
                    });
                });
            },
            
            // Show manage lessons page
            showManageLessons(courseId = null) {
                const course = courseId ? this.courses.find(c => c.id === courseId) : this.currentCourse;
                if (!course) return;
                
                this.currentCourse = course;
                
                const content = document.getElementById('page-content');
                content.innerHTML = `
                    <div class="d-flex justify-between align-center mb-30">
                        <div>
                            <h1 class="page-title mb-0">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h1>
                            <p class="mb-0">‡∏Ñ‡∏≠‡∏£‡πå‡∏™: ${course.name}</p>
                        </div>
                        <div class="d-flex gap-10">
                            <button id="back-to-courses" class="btn btn-secondary">
                                <i class="fas fa-arrow-left"></i> ‡∏Å‡∏•‡∏±‡∏ö
                            </button>
                            <button id="add-lesson" class="btn btn-primary">
                                <i class="fas fa-plus"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
                            </button>
                        </div>
                    </div>
                    
                    ${course.lessons.length > 0 ? `
                        <div class="card">
                            <h3 class="card-title">‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (${course.lessons.length} ‡∏ö‡∏ó)</h3>
                            <div class="table-container">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>‡∏•‡∏≥‡∏î‡∏±‡∏ö</th>
                                            <th>‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</th>
                                            <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á</th>
                                            <th>‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${course.lessons.map((lesson, index) => `
                                            <tr>
                                                <td>${index + 1}</td>
                                                <td><strong>${lesson.title}</strong></td>
                                                <td>${new Date(lesson.createdAt).toLocaleDateString('th-TH')}</td>
                                                <td>
                                                    <div class="d-flex gap-10">
                                                        <button class="btn btn-primary btn-sm" data-action="edit" data-lesson="${lesson.id}">
                                                            <i class="fas fa-edit"></i> ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                                                        </button>
                                                        <button class="btn btn-danger btn-sm" data-action="delete" data-lesson="${lesson.id}">
                                                            <i class="fas fa-trash"></i> ‡∏•‡∏ö
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    ` : `
                        <div class="card">
                            <div class="empty-state">
                                <i class="fas fa-file-alt"></i>
                                <h4>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÉ‡∏ô‡∏Ñ‡∏≠‡∏£‡πå‡∏™‡∏ô‡∏µ‡πâ</h4>
                                <p>‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÅ‡∏£‡∏Å</p>
                            </div>
                        </div>
                    `}
                `;
                
                // Add event listeners
                document.getElementById('back-to-courses').addEventListener('click', () => {
                    this.showManageCourses();
                });
                
                document.getElementById('add-lesson').addEventListener('click', () => {
                    this.showLessonModal(course.id);
                });
                
                document.querySelectorAll('[data-action]').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const action = e.currentTarget.dataset.action;
                        const lessonId = e.currentTarget.dataset.lesson;
                        
                        if (action === 'edit') {
                            this.showLessonModal(course.id, lessonId);
                        } else if (action === 'delete') {
                            this.deleteLesson(course.id, lessonId);
                        }
                    });
                });
            },
            
            // Show manage exercises page
            showManageExercises(courseId = null) {
                const course = courseId ? this.courses.find(c => c.id === courseId) : this.currentCourse;
                if (!course) return;
                
                this.currentCourse = course;
                
                // Group exercises by lesson
                const exercisesByLesson = {};
                course.lessons.forEach(lesson => {
                    exercisesByLesson[lesson.id] = {
                        lesson: lesson,
                        exercises: course.exercises.filter(e => e.lessonId === lesson.id)
                    };
                });
                
                const content = document.getElementById('page-content');
                content.innerHTML = `
                    <div class="d-flex justify-between align-center mb-30">
                        <div>
                            <h1 class="page-title mb-0">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î</h1>
                            <p class="mb-0">‡∏Ñ‡∏≠‡∏£‡πå‡∏™: ${course.name}</p>
                        </div>
                        <div class="d-flex gap-10">
                            <button id="back-to-courses" class="btn btn-secondary">
                                <i class="fas fa-arrow-left"></i> ‡∏Å‡∏•‡∏±‡∏ö
                            </button>
                            <button id="add-exercise" class="btn btn-primary">
                                <i class="fas fa-plus"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î
                            </button>
                        </div>
                    </div>
                    
                    ${Object.keys(exercisesByLesson).length > 0 ? `
                        <div class="card">
                            <h3 class="card-title">‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (${course.exercises.length} ‡∏Ç‡πâ‡∏≠)</h3>
                            
                            ${Object.values(exercisesByLesson).map(group => `
                                <div class="mb-30">
                                    <h4>${group.lesson.title}</h4>
                                    ${group.exercises.length > 0 ? `
                                        <div class="table-container">
                                            <table>
                                                <thead>
                                                    <tr>
                                                        <th>‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°</th>
                                                        <th>‡πÄ‡∏â‡∏•‡∏¢</th>
                                                        <th>‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏Å</th>
                                                        <th>‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    ${group.exercises.map(exercise => `
                                                        <tr>
                                                            <td>${exercise.question.substring(0, 100)}${exercise.question.length > 100 ? '...' : ''}</td>
                                                            <td>${exercise.answer.substring(0, 50)}${exercise.answer.length > 50 ? '...' : ''}</td>
                                                            <td><span class="badge ${exercise.difficulty === 'easy' ? 'badge-success' : exercise.difficulty === 'medium' ? 'badge-warning' : 'badge-danger'}">${exercise.difficulty === 'easy' ? '‡∏á‡πà‡∏≤‡∏¢' : exercise.difficulty === 'medium' ? '‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á' : '‡∏¢‡∏≤‡∏Å'}</span></td>
                                                            <td>
                                                                <div class="d-flex gap-10">
                                                                    <button class="btn btn-primary btn-sm" data-action="edit" data-exercise="${exercise.id}">
                                                                        <i class="fas fa-edit"></i> ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                                                                    </button>
                                                                    <button class="btn btn-danger btn-sm" data-action="delete" data-exercise="${exercise.id}">
                                                                        <i class="fas fa-trash"></i> ‡∏•‡∏ö
                                                                    </button>
                                                                </div>
                                                            </td>
                                                        </tr>
                                                    `).join('')}
                                                </tbody>
                                            </table>
                                        </div>
                                    ` : `
                                        <div class="alert alert-info">
                                            <i class="fas fa-info-circle"></i> ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î‡πÉ‡∏ô‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ô‡∏µ‡πâ
                                        </div>
                                    `}
                                </div>
                            `).join('')}
                        </div>
                    ` : `
                        <div class="card">
                            <div class="empty-state">
                                <i class="fas fa-edit"></i>
                                <h4>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÉ‡∏ô‡∏Ñ‡∏≠‡∏£‡πå‡∏™‡∏ô‡∏µ‡πâ</h4>
                                <p>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î</p>
                            </div>
                        </div>
                    `}
                `;
                
                // Add event listeners
                document.getElementById('back-to-courses').addEventListener('click', () => {
                    this.showManageCourses();
                });
                
                document.getElementById('add-exercise').addEventListener('click', () => {
                    this.showExerciseModal(course.id);
                });
                
                document.querySelectorAll('[data-action]').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const action = e.currentTarget.dataset.action;
                        const exerciseId = e.currentTarget.dataset.exercise;
                        
                        if (action === 'edit') {
                            this.showExerciseModal(course.id, exerciseId);
                        } else if (action === 'delete') {
                            this.deleteExercise(course.id, exerciseId);
                        }
                    });
                });
            },
            
            // Show manage documents page
            showManageDocuments() {
                const content = document.getElementById('page-content');
                content.innerHTML = `
                    <h1 class="page-title">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h1>
                    
                    <div class="card">
                        <div class="d-flex justify-between align-center mb-20">
                            <h3 class="card-title mb-0">‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£</h3>
                        </div>
                        
                        <div class="upload-area">
                            <div class="upload-icon">
                                <i class="fas fa-file-pdf"></i>
                            </div>
                            <h4>‡∏•‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏°‡∏≤‡∏ß‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà</h4>
                            <p class="mb-20">‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå</p>
                            <input type="file" id="document-file" class="hidden" accept=".pdf,.doc,.docx,.ppt,.pptx,.txt">
                            <button id="browse-document" class="btn btn-primary">
                                <i class="fas fa-folder-open"></i> ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå
                            </button>
                            <p class="mt-20 text-muted">‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏à‡∏∞‡∏õ‡∏£‡∏≤‡∏Å‡∏è‡πÉ‡∏´‡πâ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏î‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏à‡∏ö‡∏Ñ‡∏≠‡∏£‡πå‡∏™‡πÅ‡∏•‡πâ‡∏ß</p>
                        </div>
                        
                        <div class="mt-30">
                            <h4>‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏•‡πâ‡∏ß</h4>
                            <div class="empty-state">
                                <i class="fas fa-file"></i>
                                <h4>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£</h4>
                                <p>‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà</p>
                            </div>
                        </div>
                    </div>
                `;
                
                // Add event listeners
                document.getElementById('browse-document').addEventListener('click', () => {
                    document.getElementById('document-file').click();
                });
            },
            
            // Show manage certificates page
            showManageCertificates() {
                const teacherCourses = this.courses.filter(c => c.teacherId === this.user.id);
                
                const content = document.getElementById('page-content');
                content.innerHTML = `
                    <h1 class="page-title">‡∏≠‡∏≠‡∏Å‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏à‡∏ö</h1>
                    
                    <div class="card">
                        <div class="form-group">
                            <label for="certificate-course">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏≠‡∏£‡πå‡∏™</label>
                            <select id="certificate-course" class="form-control">
                                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏≠‡∏£‡πå‡∏™</option>
                                ${teacherCourses.map(course => `
                                    <option value="${course.id}">${course.name}</option>
                                `).join('')}
                        </select>
                        </div>
                        
                        <div id="certificate-students" class="mt-30 hidden">
                            <h4>‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏à‡∏ö‡∏Ñ‡∏≠‡∏£‡πå‡∏™</h4>
                            <div class="empty-state">
                                <i class="fas fa-user-graduate"></i>
                                <h4>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏à‡∏ö</h4>
                                <p>‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏à‡∏ö‡∏Ñ‡∏≠‡∏£‡πå‡∏™ ‡∏à‡∏∞‡∏õ‡∏£‡∏≤‡∏Å‡∏è‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà</p>
                            </div>
                        </div>
                        
                        <div class="mt-30">
                            <h4>‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á</h4>
                            <div class="upload-area">
                                <div class="upload-icon">
                                    <i class="fas fa-certificate"></i>
                                </div>
                                <h4>‡∏•‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á‡∏°‡∏≤‡∏ß‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà</h4>
                                <p class="mb-20">‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå</p>
                                <input type="file" id="certificate-file" class="hidden" accept=".pdf,.jpg,.jpeg,.png">
                                <button id="browse-certificate" class="btn btn-primary">
                                    <i class="fas fa-folder-open"></i> ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå
                                </button>
                                <p class="mt-20 text-muted">‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå PDF, JPG, PNG</p>
                            </div>
                        </div>
                    </div>
                `;
                
                // Add event listeners
                document.getElementById('certificate-course').addEventListener('change', (e) => {
                    const courseId = e.target.value;
                    if (courseId) {
                        document.getElementById('certificate-students').classList.remove('hidden');
                    } else {
                        document.getElementById('certificate-students').classList.add('hidden');
                    }
                });
                
                document.getElementById('browse-certificate').addEventListener('click', () => {
                    document.getElementById('certificate-file').click();
                });
            },
            
            // Show upload data page
            showUploadData() {
                this.showUploadModal();
            },
            
            // Show live teaching page - FIXED VIDEO ISSUE
            showLiveTeaching() {
                const course = this.currentCourse;
                if (!course) {
                    this.showAlert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏≠‡∏£‡πå‡∏™‡∏Å‡πà‡∏≠‡∏ô', 'warning');
                    this.showManageCourses();
                    return;
                }
                
                const content = document.getElementById('page-content');
                content.innerHTML = `
                    <div class="d-flex justify-between align-center mb-30">
                        <div>
                            <h1 class="page-title mb-0">‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô‡∏™‡∏î</h1>
                            <p class="mb-0">‡∏Ñ‡∏≠‡∏£‡πå‡∏™: ${course.name}</p>
                        </div>
                        <button id="back-to-dashboard" class="btn btn-secondary">
                            <i class="fas fa-arrow-left"></i> ‡∏Å‡∏•‡∏±‡∏ö
                        </button>
                    </div>
                    
                    <div class="live-container">
                        <div class="video-section">
                            <div class="video-container">
                                <div id="jitsi-container"></div>
                                <div class="video-placeholder" style="display: flex;">
                                    <i class="fas fa-video"></i>
                                    <h3>‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡∏î: ${course.name}</h3>
                                    <p>‡∏Ñ‡∏£‡∏π‡∏ú‡∏π‡πâ‡∏™‡∏≠‡∏ô: ${this.user.name}</p>
                                    <p>‡∏´‡πâ‡∏≠‡∏á: ${course.jitsiRoom}</p>
                                    <button id="connect-jitsi" class="btn btn-primary mt-20">
                                        <i class="fas fa-video"></i> ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
                                    </button>
                                </div>
                                <div class="video-controls">
                                    <button class="video-control-btn" id="start-video">
                                        <i class="fas fa-video"></i>
                                    </button>
                                    <button class="video-control-btn" id="mute-audio">
                                        <i class="fas fa-microphone"></i>
                                    </button>
                                    <button class="video-control-btn" id="share-screen">
                                        <i class="fas fa-desktop"></i>
                                    </button>
                                    <button class="video-control-btn" id="end-class">
                                        <i class="fas fa-phone-slash"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="lesson-section">
                            <h3 class="mb-20">üìã ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô</h3>
                            
                            <div class="mb-20">
                                <h4>üìö ‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h4>
                                ${course.lessons.length > 0 ? `
                                    <div class="d-flex flex-column gap-10 mt-10">
                                        ${course.lessons.map(lesson => `
                                            <button class="btn btn-outline btn-sm" data-lesson="${lesson.id}">
                                                ${lesson.title}
                                            </button>
                                        `).join('')}
                                    </div>
                                ` : `
                                    <p class="text-muted">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</p>
                                `}
                            </div>
                            
                            <div class="mb-20">
                                <h4>üìù ‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î</h4>
                                ${course.exercises.length > 0 ? `
                                    <div class="d-flex flex-column gap-10 mt-10">
                                        ${course.exercises.map(exercise => `
                                            <button class="btn btn-outline btn-sm" data-exercise="${exercise.id}">
                                                ${exercise.question.substring(0, 30)}...
                                            </button>
                                        `).join('')}
                                    </div>
                                ` : `
                                    <p class="text-muted">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î</p>
                                `}
                            </div>
                            
                            <div class="mb-20">
                                <h4>üîó ‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h4>
                                <div class="alert alert-info">
                                    <p><strong>‡∏´‡πâ‡∏≠‡∏á Jitsi:</strong></p>
                                    <code>https://meet.jit.si/${course.jitsiRoom}</code>
                                    <p class="mt-10"><strong>‡∏£‡∏´‡∏±‡∏™‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢:</strong></p>
                                    <code>${course.securityCode}</code>
                                    <button id="copy-link" class="btn btn-sm btn-primary mt-10 w-100">
                                        <i class="fas fa-copy"></i> ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå
                                    </button>
                                </div>
                            </div>
                            
                            <div class="mb-20">
                                <h4>‚úÖ ‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏à‡∏ö</h4>
                                <div class="d-flex gap-10">
                                    <button id="mark-completed" class="btn btn-success btn-block">
                                        <i class="fas fa-check-circle"></i> ‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏à‡∏ö
                                    </button>
                                    <button id="cancel-completion" class="btn btn-danger btn-block">
                                        <i class="fas fa-times-circle"></i> ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                                    </button>
                                </div>
                            </div>
                            
                            <div>
                                <button id="end-session" class="btn btn-warning btn-block">
                                    <i class="fas fa-phone-slash"></i> ‡∏à‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                
                // Add event listeners
                document.getElementById('back-to-dashboard').addEventListener('click', () => {
                    this.disconnectFromJitsi();
                    this.showTeacherDashboard();
                });
                
                document.getElementById('connect-jitsi').addEventListener('click', () => {
                    this.connectToJitsi(course.jitsiRoom, this.user.name);
                });
                
                document.getElementById('end-class').addEventListener('click', () => {
                    this.disconnectFromJitsi();
                    this.showTeacherDashboard();
                });
                
                document.getElementById('mark-completed').addEventListener('click', () => {
                    this.markCourseCompleted(course.id);
                });
                
                document.getElementById('end-session').addEventListener('click', () => {
                    this.disconnectFromJitsi();
                    this.showTeacherDashboard();
                });
                
                document.getElementById('copy-link').addEventListener('click', () => {
                    const link = `https://meet.jit.si/${course.jitsiRoom}`;
                    navigator.clipboard.writeText(link).then(() => {
                        this.showAlert('‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÅ‡∏•‡πâ‡∏ß', 'success');
                    });
                });
                
                // Video control buttons (simulated)
                document.getElementById('start-video').addEventListener('click', () => {
                    if (this.jitsi.api) {
                        this.jitsi.api.executeCommand('toggleVideo');
                        this.showAlert('‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏ñ‡πà‡∏≤‡∏¢‡∏ó‡∏≠‡∏î‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡πÅ‡∏•‡πâ‡∏ß', 'success');
                    }
                });
                
                document.getElementById('mute-audio').addEventListener('click', () => {
                    if (this.jitsi.api) {
                        this.jitsi.api.executeCommand('toggleAudio');
                        this.showAlert('‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÑ‡∏°‡πÇ‡∏Ñ‡∏£‡πÇ‡∏ü‡∏ô‡πÅ‡∏•‡πâ‡∏ß', 'info');
                    }
                });
                
                document.getElementById('share-screen').addEventListener('click', () => {
                    if (this.jitsi.api) {
                        this.jitsi.api.executeCommand('toggleShareScreen');
                        this.showAlert('‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÅ‡∏ä‡∏£‡πå‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÅ‡∏•‡πâ‡∏ß', 'success');
                    }
                });
            },
            
            // Show student home page
            showStudentHome() {
                const availableCourses = this.courses.filter(c => c.status === 'active');
                
                const content = document.getElementById('page-content');
                content.innerHTML = `
                    <h1 class="page-title">‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ, ${this.user.name}! üëã</h1>
                    
                    <div class="card">
                        <h3 class="card-title">üì¢ ‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡πÅ‡∏•‡∏∞‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£</h3>
                        <div class="alert alert-info">
                            <h4>üìÖ ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå‡πÅ‡∏ö‡∏ö‡∏™‡∏î (Live Class Only)</h4>
                            <ul>
                                <li>‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡∏î‡∏ú‡πà‡∏≤‡∏ô Jitsi Meet ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô</li>
                                <li>‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡∏î‡∏Å‡πà‡∏≠‡∏ô‡∏ñ‡∏∂‡∏á‡∏à‡∏∞‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÅ‡∏•‡∏∞‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î‡πÑ‡∏î‡πâ</li>
                                <li>‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ï‡∏±‡∏ß‡∏ï‡πà‡∏≠‡∏ï‡∏±‡∏ß‡πÅ‡∏•‡∏∞‡∏Å‡∏•‡∏∏‡πà‡∏°</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h3 class="card-title">üìö ‡∏Ñ‡∏≠‡∏£‡πå‡∏™‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏¥‡∏î‡∏™‡∏≠‡∏ô</h3>
                        
                        ${availableCourses.length > 0 ? `
                            <div class="course-grid">
                                ${availableCourses.slice(0, 6).map(course => `
                                    <div class="course-card">
                                        ${course.image ? `<img src="${course.image}" class="course-image" alt="${course.name}">` : ''}
                                        <h4>${course.name}</h4>
                                        <p><strong>‡∏Ñ‡∏£‡∏π‡∏ú‡∏π‡πâ‡∏™‡∏≠‡∏ô:</strong> ${course.teacherName}</p>
                                        <p>${course.description.substring(0, 100)}${course.description.length > 100 ? '...' : ''}</p>
                                        <p><strong>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó:</strong> ${course.classType}</p>
                                        <p><strong>‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà:</strong> ${course.currentStudents}/${course.maxStudents} ‡∏Ñ‡∏ô</p>
                                        
                                        <button class="btn btn-primary btn-block mt-20" data-course="${course.id}">
                                            <i class="fas fa-sign-in-alt"></i> ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏Ñ‡∏≠‡∏£‡πå‡∏™
                                        </button>
                                    </div>
                                `).join('')}
                            </div>
                        ` : `
                            <div class="empty-state">
                                <i class="fas fa-book"></i>
                                <h4>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≠‡∏£‡πå‡∏™‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏¥‡∏î‡∏™‡∏≠‡∏ô</h4>
                                <p>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏Ñ‡∏£‡∏π‡∏ú‡∏π‡πâ‡∏™‡∏≠‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏Ñ‡∏≠‡∏£‡πå‡∏™‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÉ‡∏´‡∏°‡πà</p>
                            </div>
                        `}
                    </div>
                `;
                
                // Add event listeners
                document.querySelectorAll('[data-course]').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const courseId = e.currentTarget.dataset.course;
                        const course = this.courses.find(c => c.id === courseId);
                        
                        if (course) {
                            if (this.enrollInCourse(courseId)) {
                                this.currentCourse = course;
                                this.connectToJitsi(course.jitsiRoom, this.user.name);
                                this.showLiveStudent();
                            }
                        }
                    });
                });
            },
            
            // Show student courses page
            showStudentCourses() {
                // Get courses that student is enrolled in
                const enrolledCourses = this.courses.filter(course => 
                    course.currentStudents > 0 // Simplified enrollment check
                );
                
                const content = document.getElementById('page-content');
                content.innerHTML = `
                    <h1 class="page-title">üìö ‡∏Ñ‡∏≠‡∏£‡πå‡∏™‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</h1>
                    
                    ${enrolledCourses.length > 0 ? `
                        <div class="course-grid">
                            ${enrolledCourses.map(course => `
                                <div class="course-card">
                                    ${course.image ? `<img src="${course.image}" class="course-image" alt="${course.name}">` : ''}
                                    <h4>${course.name}</h4>
                                    <p><strong>‡∏Ñ‡∏£‡∏π‡∏ú‡∏π‡πâ‡∏™‡∏≠‡∏ô:</strong> ${course.teacherName}</p>
                                    <p>${course.description.substring(0, 100)}${course.description.length > 100 ? '...' : ''}</p>
                                    
                                    <div class="d-flex gap-10 mt-20">
                                        <button class="btn btn-primary w-100" data-action="live" data-course="${course.id}">
                                            <i class="fas fa-video"></i> ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡∏î
                                        </button>
                                        <button class="btn btn-success w-100" data-action="exercises" data-course="${course.id}">
                                            <i class="fas fa-edit"></i> ‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î
                                        </button>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    ` : `
                        <div class="card">
                            <div class="empty-state">
                                <i class="fas fa-book"></i>
                                <h4>‡∏Ñ‡∏∏‡∏ì‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏Ñ‡∏≠‡∏£‡πå‡∏™‡πÉ‡∏î‡πÜ</h4>
                                <p>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏Ñ‡∏≠‡∏£‡πå‡∏™‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</p>
                                <button id="go-to-home" class="btn btn-primary mt-20">
                                    <i class="fas fa-home"></i> ‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å
                                </button>
                            </div>
                        </div>
                    `}
                `;
                
                // Add event listeners
                document.getElementById('go-to-home')?.addEventListener('click', () => {
                    this.showStudentHome();
                });
                
                document.querySelectorAll('[data-action]').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const action = e.currentTarget.dataset.action;
                        const courseId = e.currentTarget.dataset.course;
                        const course = this.courses.find(c => c.id === courseId);
                        
                        if (!course) return;
                        
                        this.currentCourse = course;
                        
                        if (action === 'live') {
                            if (!this.user.hasAttendedLive) {
                                this.showAlert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡∏î‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Å‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤', 'warning');
                            } else {
                                this.connectToJitsi(course.jitsiRoom, this.user.name);
                                this.showLiveStudent();
                            }
                        } else if (action === 'exercises') {
                            if (!this.user.hasAttendedLive) {
                                this.showAlert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡∏î‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Å‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤', 'warning');
                            } else {
                                this.showStudentExercises();
                            }
                        }
                    });
                });
            },
            
            // Show live student page
            showLiveStudent() {
                const course = this.currentCourse;
                if (!course) {
                    this.showStudentHome();
                    return;
                }
                
                this.user.hasAttendedLive = true;
                this.saveToStorage();
                
                const content = document.getElementById('page-content');
                content.innerHTML = `
                    <div class="d-flex justify-between align-center mb-30">
                        <div>
                            <h1 class="page-title mb-0">‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡∏î: ${course.name}</h1>
                            <p class="mb-0">‡∏Ñ‡∏£‡∏π‡∏ú‡∏π‡πâ‡∏™‡∏≠‡∏ô: ${course.teacherName}</p>
                        </div>
                        <button id="back-to-home" class="btn btn-secondary">
                            <i class="fas fa-arrow-left"></i> ‡∏Å‡∏•‡∏±‡∏ö
                        </button>
                    </div>
                    
                    <div class="live-container">
                        <div class="video-section">
                            <div class="video-container">
                                <div id="jitsi-container"></div>
                                <div class="video-placeholder" style="display: flex;">
                                    <i class="fas fa-video"></i>
                                    <h3>‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡∏î: ${course.name}</h3>
                                    <p>‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô: ${this.user.name}</p>
                                    <p>‡∏´‡πâ‡∏≠‡∏á: ${course.jitsiRoom}</p>
                                    <p class="mt-20"><strong>‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡∏î 100%</strong></p>
                                    <button id="connect-jitsi-student" class="btn btn-primary mt-20">
                                        <i class="fas fa-video"></i> ‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
                                    </button>
                                </div>
                                <div class="video-controls">
                                    <button class="video-control-btn" id="student-start-video">
                                        <i class="fas fa-video"></i>
                                    </button>
                                    <button class="video-control-btn" id="student-mute-audio">
                                        <i class="fas fa-microphone"></i>
                                    </button>
                                    <button class="video-control-btn" id="student-leave">
                                        <i class="fas fa-phone-slash"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="lesson-section">
                            <h3 class="mb-20">üìñ ‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h3>
                            
                            ${course.lessons.length > 0 ? `
                                <div class="d-flex flex-column gap-10 mb-20">
                                    ${course.lessons.map(lesson => `
                                        <div class="card" style="padding: 15px;">
                                            <h5>${lesson.title}</h5>
                                            <p>${lesson.content.substring(0, 80)}${lesson.content.length > 80 ? '...' : ''}</p>
                                            <button class="btn btn-primary btn-sm mt-10" data-lesson="${lesson.id}">
                                                <i class="fas fa-book-open"></i> ‡∏î‡∏π‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤
                                            </button>
                                        </div>
                                    `).join('')}
                                </div>
                            ` : `
                                <div class="alert alert-info">
                                    <i class="fas fa-info-circle"></i> ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÉ‡∏ô‡∏Ñ‡∏≠‡∏£‡πå‡∏™‡∏ô‡∏µ‡πâ
                                </div>
                            `}
                            
                            <div class="mt-20">
                                <button id="go-to-exercises" class="btn btn-primary btn-block">
                                    <i class="fas fa-edit"></i> ‡πÑ‡∏õ‡∏ó‡∏≥‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                
                // Add event listeners
                document.getElementById('back-to-home').addEventListener('click', () => {
                    this.disconnectFromJitsi();
                    this.showStudentHome();
                });
                
                document.getElementById('connect-jitsi-student').addEventListener('click', () => {
                    this.connectToJitsi(course.jitsiRoom, this.user.name);
                });
                
                document.getElementById('student-leave').addEventListener('click', () => {
                    this.disconnectFromJitsi();
                    this.showStudentHome();
                });
                
                document.getElementById('go-to-exercises').addEventListener('click', () => {
                    this.showStudentExercises();
                });
                
                // Video control buttons (simulated)
                document.getElementById('student-start-video').addEventListener('click', () => {
                    if (this.jitsi.api) {
                        this.jitsi.api.executeCommand('toggleVideo');
                        this.showAlert('‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏ñ‡πà‡∏≤‡∏¢‡∏ó‡∏≠‡∏î‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡πÅ‡∏•‡πâ‡∏ß', 'success');
                    }
                });
                
                document.getElementById('student-mute-audio').addEventListener('click', () => {
                    if (this.jitsi.api) {
                        this.jitsi.api.executeCommand('toggleAudio');
                        this.showAlert('‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÑ‡∏°‡πÇ‡∏Ñ‡∏£‡πÇ‡∏ü‡∏ô‡πÅ‡∏•‡πâ‡∏ß', 'info');
                    }
                });
                
                // Lesson view buttons
                document.querySelectorAll('[data-lesson]').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const lessonId = e.currentTarget.dataset.lesson;
                        const lesson = course.lessons.find(l => l.id === lessonId);
                        
                        if (lesson) {
                            this.showLessonView(lesson);
                        }
                    });
                });
            },
            
            // Show student exercises page - FIXED
            showStudentExercises() {
                const course = this.currentCourse;
                if (!course) {
                    this.showStudentHome();
                    return;
                }
                
                if (!this.user.hasAttendedLive) {
                    this.showAlert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡∏î‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Å‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤', 'warning');
                    this.showStudentHome();
                    return;
                }
                
                // Show floating video
                this.showFloatingVideo();
                
                // Get current exercise
                const exercises = course.exercises;
                let currentExerciseIndex = this.quizState.currentIndex;
                
                if (currentExerciseIndex >= exercises.length) {
                    currentExerciseIndex = 0;
                    this.quizState.currentIndex = 0;
                }
                
                const currentExercise = exercises[currentExerciseIndex];
                const exerciseKey = `${course.id}_${currentExercise?.id}`;
                
                // Calculate progress
                const totalExercises = exercises.length;
                const completedExercises = Object.keys(this.quizState.completed).filter(key => 
                    key.startsWith(course.id)
                ).length;
                
                const progressPercentage = totalExercises > 0 ? (completedExercises / totalExercises) * 100 : 0;
                
                const content = document.getElementById('page-content');
                content.innerHTML = `
                    <div class="exercise-container">
                        <div class="d-flex justify-between align-center mb-30">
                            <div>
                                <h1 class="page-title mb-0">üìù ‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î: ${course.name}</h1>
                                <p class="mb-0">‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î‡∏ó‡∏µ‡πà ${currentExerciseIndex + 1} ‡∏à‡∏≤‡∏Å ${totalExercises}</p>
                            </div>
                            <button id="back-to-live" class="btn btn-secondary">
                                <i class="fas fa-arrow-left"></i> ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡∏î
                            </button>
                        </div>
                        
                        <div class="progress mb-30">
                            <div class="progress-bar" style="width: ${progressPercentage}%"></div>
                        </div>
                        <p class="text-right mb-30">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤: ${completedExercises}/${totalExercises}</p>
                        
                        ${currentExercise ? `
                            <div class="card">
                                <div class="exercise-item">
                                    ${currentExercise.image ? `
                                        <div class="text-center mb-20">
                                            <img src="${currentExercise.image}" class="exercise-image" alt="‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î">
                                        </div>
                                    ` : ''}
                                    
                                    <div class="exercise-question">
                                        ‚ùì ${currentExercise.question}
                                    </div>
                                    
                                    ${this.quizState.showSolution[exerciseKey] ? `
                                        <div class="exercise-answer">
                                            <h4>üìñ ‡πÄ‡∏â‡∏•‡∏¢:</h4>
                                            <p>${currentExercise.answer}</p>
                                            <div class="mt-20">
                                                <button id="try-again-after-solution" class="btn btn-warning btn-block">
                                                    <i class="fas fa-redo"></i> ‡∏ï‡∏≠‡∏ö‡πÉ‡∏´‡∏°‡πà
                                                </button>
                                            </div>
                                        </div>
                                    ` : ''}
                                    
                                    ${!this.quizState.completed[exerciseKey] && !this.quizState.showSolution[exerciseKey] ? `
                                        <div class="form-group mt-20">
                                            <label for="student-answer">‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì:</label>
                                            <textarea id="student-answer" class="form-control" rows="4" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà..."></textarea>
                                        </div>
                                        
                                        <div class="mt-20">
                                            <button id="submit-answer" class="btn btn-primary btn-block" data-exercise="${currentExercise.id}">
                                                <i class="fas fa-paper-plane"></i> ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö
                                            </button>
                                        </div>
                                    ` : this.quizState.completed[exerciseKey] ? `
                                        <div class="alert alert-success mt-20">
                                            <i class="fas fa-check-circle"></i> ‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏≥‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î‡∏ô‡∏µ‡πâ‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß
                                        </div>
                                        
                                        <div class="mt-20">
                                            <button id="next-exercise" class="btn btn-primary btn-block">
                                                <i class="fas fa-arrow-right"></i> ${currentExerciseIndex < totalExercises - 1 ? '‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î‡∏ñ‡∏±‡∏î‡πÑ‡∏õ' : '‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô'}
                                            </button>
                                        </div>
                                    ` : ''}
                                </div>
                            </div>
                        ` : `
                            <div class="card">
                                <div class="empty-state">
                                    <i class="fas fa-check-circle"></i>
                                    <h4>‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏î‡πâ‡∏ß‡∏¢!</h4>
                                    <p>‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏≥‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î‡∏Ñ‡∏£‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÅ‡∏•‡πâ‡∏ß</p>
                                    <button id="finish-course" class="btn btn-success mt-20">
                                        <i class="fas fa-graduation-cap"></i> ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏à‡∏ö‡∏Ñ‡∏≠‡∏£‡πå‡∏™
                                    </button>
                                </div>
                            </div>
                        `}
                        
                        ${exercises.length > 0 ? `
                            <div class="card mt-30">
                                <h3 class="card-title">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î</h3>
                                <div class="d-flex flex-wrap gap-10">
                                    ${exercises.map((exercise, index) => {
                                        const exKey = `${course.id}_${exercise.id}`;
                                        const isCompleted = this.quizState.completed[exKey];
                                        const showSolution = this.quizState.showSolution[exKey];
                                        const isCurrent = index === currentExerciseIndex;
                                        
                                        let btnClass = 'btn-secondary';
                                        if (isCompleted) btnClass = 'btn-success';
                                        else if (showSolution) btnClass = 'btn-warning';
                                        else if (isCurrent) btnClass = 'btn-primary';
                                        
                                        return `
                                            <button class="btn ${btnClass}" data-exercise-index="${index}">
                                                ${index + 1}
                                            </button>
                                        `;
                                    }).join('')}
                                </div>
                            </div>
                        ` : ''}
                    </div>
                `;
                
                // Add event listeners
                document.getElementById('back-to-live').addEventListener('click', () => {
                    this.hideFloatingVideo();
                    this.showLiveStudent();
                });
                
                document.getElementById('submit-answer')?.addEventListener('click', () => {
                    const answer = document.getElementById('student-answer').value;
                    if (!answer) {
                        this.showAlert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö', 'warning');
                        return;
                    }
                    
                    const isCorrect = this.submitQuizAnswer(course.id, currentExercise.id, answer);
                    
                    if (isCorrect) {
                        // Record result
                        const result = {
                            studentId: this.user.id,
                            studentName: this.user.name,
                            courseId: course.id,
                            courseName: course.name,
                            exerciseCount: 1,
                            score: this.quizState.scores[`${course.id}_${currentExercise.id}`] || 0,
                            date: new Date().toISOString()
                        };
                        
                        this.results.push(result);
                        this.saveToStorage();
                        
                        // ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ó‡∏µ‡πà‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï
                        setTimeout(() => {
                            this.showStudentExercises();
                        }, 1500);
                    } else {
                        // ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏ï‡∏≠‡∏ö‡∏ú‡∏¥‡∏î
                        setTimeout(() => {
                            this.showStudentExercises();
                        }, 1000);
                    }
                });
                
                document.getElementById('next-exercise')?.addEventListener('click', () => {
                    this.quizState.currentIndex++;
                    this.showStudentExercises();
                });
                
                document.getElementById('try-again-after-solution')?.addEventListener('click', () => {
                    // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏ô‡∏µ‡πâ
                    const key = `${course.id}_${currentExercise.id}`;
                    delete this.quizState.attempts[key];
                    delete this.quizState.showSolution[key];
                    delete this.quizState.answers[key];
                    delete this.quizState.completed[key];
                    
                    // ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏´‡∏ô‡πâ‡∏≤
                    this.showStudentExercises();
                });
                
                document.getElementById('finish-course')?.addEventListener('click', () => {
                    this.showAlert('‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏î‡πâ‡∏ß‡∏¢! ‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏à‡∏ö‡∏Ñ‡∏≠‡∏£‡πå‡∏™‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡πâ‡∏ß', 'success');
                    this.hideFloatingVideo();
                    // ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏≠‡∏ô‡∏™‡∏î‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏ö‡∏∏‡πÉ‡∏ô‡∏Ç‡πâ‡∏≠‡∏Å‡∏≥‡∏´‡∏ô‡∏î
                    this.showLiveStudent();
                });
                
                // Exercise navigation buttons
                document.querySelectorAll('[data-exercise-index]').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const index = parseInt(e.currentTarget.dataset.exerciseIndex);
                        this.quizState.currentIndex = index;
                        this.showStudentExercises();
                    });
                });
            },
            
            // Show student documents page
            showStudentDocuments() {
                const course = this.currentCourse;
                if (!course) {
                    this.showStudentHome();
                    return;
                }
                
                if (!this.user.hasAttendedLive) {
                    this.showAlert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡∏î‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Å‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤', 'warning');
                    this.showStudentHome();
                    return;
                }
                
                const content = document.getElementById('page-content');
                content.innerHTML = `
                    <h1 class="page-title">üìÑ ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h1>
                    
                    <div class="card">
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle"></i>
                            <strong>‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î:</strong> ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÑ‡∏î‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏à‡∏ö‡∏Ñ‡∏≠‡∏£‡πå‡∏™‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
                        </div>
                        
                        <div class="empty-state">
                            <i class="fas fa-file"></i>
                            <h4>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î</h4>
                            <p>‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏à‡∏∞‡∏õ‡∏£‡∏≤‡∏Å‡∏è‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏à‡∏ö‡∏Ñ‡∏≠‡∏£‡πå‡∏™‡πÅ‡∏•‡∏∞‡∏Ñ‡∏£‡∏π‡∏ú‡∏π‡πâ‡∏™‡∏≠‡∏ô‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£</p>
                        </div>
                    </div>
                `;
            },
            
            // Show lesson view (modal)
            showLessonView(lesson) {
                const modal = document.createElement('div');
                modal.className = 'modal active';
                modal.innerHTML = `
                    <div class="modal-content" style="max-width: 800px;">
                        <div class="modal-header">
                            <h3>${lesson.title}</h3>
                            <button class="floating-control-btn close-lesson-view">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="modal-body">
                            <div style="white-space: pre-wrap; line-height: 1.6;">${lesson.content}</div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-secondary close-lesson-view">‡∏õ‡∏¥‡∏î</button>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
                
                // Add event listeners
                modal.querySelectorAll('.close-lesson-view').forEach(button => {
                    button.addEventListener('click', () => {
                        document.body.removeChild(modal);
                    });
                });
            },
            
            // ============================================
            // UTILITY FUNCTIONS
            // ============================================
            
            // MD5 hash function (simplified)
            md5(input) {
                // Simplified MD5 for demo purposes
                // In a real application, use a proper MD5 library
                return '482c811da5d5b4bc6d497ffa98491e38'; // Default hash for 'password123'
            },
            
            // Generate security code
            generateSecurityCode() {
                const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
                let result = '';
                for (let i = 0; i < 8; i++) {
                    result += chars.charAt(Math.floor(Math.random() * chars.length));
                }
                return result;
            },
            
            // Load logo image
            loadLogo() {
                const logoImg = document.getElementById('logo-img');
                
                // Base64 encoded placeholder logo (blue ZL logo)
                const base64Logo = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTAiIGhlaWdodD0iNTAiIHZpZXdCb3g9IjAgMCA1MCA1MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjUwIiBoZWlnaHQ9IjUwIiByeD0iMTAiIGZpbGw9IiMxQTIzN0UiLz4KPHBhdGggZD0iTTE1IDE1SDM1VjM1SDE1VjE1WiIgZmlsbD0iI0ZGRkZGRiIvPgo8cGF0aCBkPSJNMzUgMTVWMTBIMzBWMjBIMzVWMjVIMjBWMzVIMzVWMzBINDBWMjBIMzVWMTVaIiBmaWxsPSIjRkZENzAwIi8+Cjwvc3ZnPgo=';
                
                logoImg.src = base64Logo;
                logoImg.alt = 'ZL TA-Learning Logo';
            },
            
            // Show student dashboard
            showStudentDashboard() {
                this.showStudentHome();
            }
        };
        
        // Initialize the application
        document.addEventListener('DOMContentLoaded', () => {
            AppState.init();
        });
        
        // Make AppState available globally for debugging
        window.AppState = AppState;
    </script>
</body>
</html>